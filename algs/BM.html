<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="/assets/fonts/fonts.css"/>
<link rel="stylesheet" href="/assets/style.css"/>
<link rel="stylesheet" href="/assets/js/lity.min.css"/>


<link rel='shortcut icon' type='image/jpeg' href='/d2.jpg' />


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta property="og:site_name" content="MINGHU6's Blog" />
<meta
    property="og:title"
    content="
        
            Boyer-Mooreç®—æ³•
        
    "
/>

<meta property="og:url" content="//algs/BM.html" />

    <meta property="og:type" content="article" />



    <meta property="fb:app_id" content="" />



<title>
    
        Boyer-Mooreç®—æ³•
    
</title>

</head>
<body class="index" data-spy="scroll" data-target="#toc" tabindex="0">

    <div class="header">
    <div id="topbar" class="d-flex align-items-center justify-content-between h-100">
  <span id="breadcrumb">

    

    

    

    
    <span>
      <a href="/">
        Home
      </a>
    </span>
    

    

    

    

    

    

    
  </span><!-- endof #breadcrumb -->

  <section class="logo">
    <a href="/" class="logo__link">
      
      <img class="logo__link__img" src="/d3.jpg" />
      
    </a>
  </section>

  <span id="search-wrapper" class="align-items-center">
    <!-- <i class="fas fa-search fa-fw"></i> -->
    <img src="/assets/img/icons/search.png">
    <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off"
      placeholder="Search...">
  </span>
  <span id="search-cancel">Cancel</span>

</div>


    

    <nav class="menu">
        
    </nav>
</div>


    <div class="page main">
    <main class="page__main" id="core-wrapper">
        <article class="post">

  <div class="post__title">
    <h1 class="post__title__text">Boyer-Mooreç®—æ³•</h1>
  </div>
  <div class="post__meta">
    <div class="post__meta__category">
      
        
        <a href="/category/algs.html">
          <p class="post__meta__category__title" style="background: var(--c-themeHueOrange)">
            Algorithm
          </p>
        </a>
      
    </div>
    <p class="post__meta__divider">Â·</p>
    <div class="post__meta__date">
      August 01, 2020
    </div>
    
  </div>

  

  <div class="post__content_container">
    <div class="post__content"><p>author: minghu6</p>

<p><em>æœ¬ç« èŠ‚å†…å®¹éœ€è¦ä»¥ã€Šå‰ç¼€å‡½æ•°ä¸KMPç®—æ³•ã€‹ä½œä¸ºå‰ç½®ç« èŠ‚ã€‚</em></p>

<p>ä¹‹å‰çš„KMPç®—æ³•å°†å‰ç¼€åŒ¹é…çš„ä¿¡æ¯ç”¨åˆ°äº†æè‡´ï¼Œ</p>

<p>è€ŒBMç®—æ³•èƒŒåçš„åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡åç¼€åŒ¹é…è·å¾—æ¯”å‰ç¼€åŒ¹é…æ›´å¤šçš„ä¿¡æ¯æ¥å®ç°æ›´å¿«çš„è·³è½¬ã€‚</p>

<h2 id="åŸºç¡€ä»‹ç»">åŸºç¡€ä»‹ç»</h2>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„çš„æ¨¡å¼å­—ç¬¦ä¸²$pat$ï¼Œè¢«æ”¾åœ¨æ–‡æœ¬å­—ç¬¦ä¸²$string$çš„å·¦æ‰‹èµ·å¤´éƒ¨ï¼Œä½¿å®ƒä»¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å¯¹é½ã€‚</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\texttt{EXAMPLE} \\
\textit{string}:\qquad\quad &amp;\texttt{HERE IS A SIMPLE EXAMPLE} \dots \\
&amp;\qquad\ \ \ \, \, \Uparrow
\end{aligned}\]

<p>åœ¨è¿™é‡Œåšå®šä¹‰ï¼Œå¾€åä¸èµ˜è¿°ï¼š</p>

<p>$pat$çš„é•¿åº¦ä¸º $patlen$ï¼Œç‰¹åˆ«åœ°å¯¹äºä»0å¼€å§‹çš„ä¸²æ¥è¯´ï¼Œè§„å®š$patlastpos=patlen-1$ä¸º$pat$ä¸²æœ€åä¸€ä¸ªå­—ç¬¦çš„ä½ç½®;</p>

<p>$string$çš„é•¿åº¦$stringlen$ï¼Œ$stringlastpos = stringlen-1$ã€‚</p>

<p>å‡å¦‚æˆ‘ä»¬çŸ¥é“äº†$string$çš„ç¬¬$patlen$ä¸ªå­—ç¬¦$char$ï¼ˆä¸$pat$çš„æœ€åä¸€ä¸ªå­—ç¬¦å¯¹é½ï¼‰è€ƒè™‘æˆ‘ä»¬èƒ½å¾—åˆ°ä»€ä¹ˆä¿¡æ¯ï¼š</p>

<p><strong>è§‚å¯Ÿ1</strong>ï¼š</p>

<p>å¦‚æœæˆ‘ä»¬çŸ¥é“$char$è¿™ä¸ªå­—ç¬¦ä¸åœ¨$pat$ä¸­,  æˆ‘ä»¬å°±ä¸ç”¨è€ƒè™‘$pat$ä»$string$çš„ç¬¬1ä¸ªã€ç¬¬2ä¸ªã€ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ç¬¬$patlen$ä¸ªå­—ç¬¦èµ·å‡ºç°çš„æƒ…å†µ,ï¼Œè€Œå¯ä»¥ç›´æ¥å°†$pat$å‘ä¸‹æ»‘åŠ¨$patlen$ä¸ªå­—ç¬¦ã€‚</p>

<p><strong>è§‚å¯Ÿ2</strong>ï¼š</p>

<p>æ›´ä¸€èˆ¬åœ°ï¼Œ<strong>å¦‚æœå‡ºç°åœ¨$pat$æœ€æœ«å°¾ï¼ˆä¹Ÿå°±æ˜¯æœ€å³è¾¹ï¼‰çš„é‚£ä¸€ä¸ª$char$å­—ç¬¦çš„ä½ç½®æ˜¯ç¦»æœ«å°¾ç«¯å·®äº†$delta_1$ä¸ªå­—ç¬¦</strong>ï¼Œ</p>

<p>é‚£ä¹ˆå°±å¯ä»¥ä¸ç”¨åŒ¹é…ï¼Œç›´æ¥å°†$pat$å‘åæ»‘åŠ¨$delta_1$ä¸ªå­—ç¬¦ï¼šå¦‚æœæ»‘åŠ¨è·ç¦»å°‘äº$delta_1$ï¼Œé‚£ä¹ˆä»…å°±$char$è¿™ä¸ªå­—ç¬¦å°±æ— æ³•è¢«åŒ¹é…ï¼Œå½“ç„¶æ¨¡å¼å­—ç¬¦ä¸²$pat$ä¹Ÿå°±ä¸ä¼šè¢«åŒ¹é…ã€‚</p>

<p>å› æ­¤é™¤é$char$å­—ç¬¦å¯ä»¥å’Œ$pat$æœ«å°¾çš„é‚£ä¸ªå­—ç¬¦åŒ¹é…ï¼Œå¦åˆ™$string$è¦è·³è¿‡$delta_1$ä¸ªå­—ç¬¦ï¼ˆç›¸å½“äº$pat$å‘åæ»‘åŠ¨äº†$delta_1$ä¸ªå­—ç¬¦ï¼‰ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªè®¡ç®—$delta_1$çš„å‡½æ•°$delta_1(char)$ï¼š</p>

\[\begin{array}{ll}
\textbf{int}\ delta1(\textbf{char}\ char) \\
\qquad \textbf{if}\ \text{charä¸åœ¨patä¸­ || charæ˜¯patä¸Šæœ€åä¸€ä¸ªå­—ç¬¦} \\
\qquad\qquad\textbf{return}\ patlen \\
\qquad \textbf{else} \\
\qquad\qquad\textbf{return}\ patlastpos-i\quad\textbf{\\\\}\ \text{iä¸ºå‡ºç°åœ¨patæœ€æœ«å°¾çš„é‚£ä¸€ä¸ªcharå‡ºç°çš„ä½ç½®ï¼Œå³pat[i]=char}
\end{array}\]

<p><strong>æ³¨æ„ï¼šæ˜¾ç„¶è¿™ä¸ªè¡¨åªéœ€è®¡ç®—åˆ°$patlastpos-1$çš„ä½ç½®</strong></p>

<p>ç°åœ¨å‡è®¾$char$å’Œ$pat$æœ€åä¸€ä¸ªå­—ç¬¦åŒ¹é…åˆ°äº†ï¼Œé‚£æˆ‘ä»¬å°±çœ‹çœ‹$char$å‰ä¸€ä¸ªå­—ç¬¦å’Œ$pat$çš„å€’æ•°ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯å¦åŒ¹é…ï¼Œ</p>

<p>å¦‚æœæ˜¯ï¼Œå°±ç»§ç»­å›é€€ç›´åˆ°æ•´ä¸ªæ¨¡å¼ä¸²$pat$å®ŒæˆåŒ¹é…ï¼ˆè¿™æ—¶æˆ‘ä»¬å°±åœ¨$string$ä¸ŠæˆåŠŸå¾—åˆ°äº†ä¸€ä¸ª$pat$çš„åŒ¹é…ï¼‰ï¼›</p>

<p>æˆ–è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½ä¼šåœ¨åŒ¹é…å®Œ$pat$çš„å€’æ•°ç¬¬$m$ä¸ªå­—ç¬¦åï¼Œåœ¨å€’æ•°ç¬¬$m+1$ä¸ªå­—ç¬¦ä¸Šå¤±é…ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¸Œæœ›æŠŠ$pat$å‘åæ»‘åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯èƒ½ä¼šå®ç°åŒ¹é…çš„ä½ç½®ï¼Œ</p>

<p>å½“ç„¶æˆ‘ä»¬å¸Œæœ›æ»‘åŠ¨å¾—è¶Šè¿œè¶Šå¥½ã€‚</p>

<p><strong>è§‚å¯Ÿ3(a)</strong>ï¼š</p>

<p>åœ¨<strong>è§‚å¯Ÿ2</strong>ä¸­æåˆ°ï¼Œå½“åŒ¹é…å®Œ$pat$çš„å€’æ•°$m$ä¸ªå­—ç¬¦åï¼Œå¦‚æœåœ¨å€’æ•°ç¬¬$m+1$ä¸ªå­—ç¬¦å¤±é…ï¼Œä¸ºäº†ä½¿å¾—$string$ä¸­çš„å¤±é…å­—ç¬¦ä¸$pat$ä¸Šå¯¹åº”å­—ç¬¦å¯¹é½ï¼Œ</p>

<p>éœ€è¦æŠŠ$pat$å‘åæ»‘åŠ¨$k$ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åº”è¯¥æŠŠæ³¨æ„åŠ›çœ‹å‘ä¹‹åçš„$k+m$ä¸ªå­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯çœ‹å‘$pat$æ»‘åŠ¨kä¹‹åï¼Œæœ«æ®µä¸$string$å¯¹é½çš„é‚£ä¸ªå­—ç¬¦ï¼‰ã€‚</p>

<p>è€Œ$k=delta_1-m$ï¼Œ</p>

<p>æ‰€ä»¥æˆ‘ä»¬çš„æ³¨æ„åŠ›åº”è¯¥æ²¿ç€$string$å‘åè·³$delta_1-m+m = delta_1$ä¸ªå­—ç¬¦ã€‚</p>

<p>ç„¶è€Œï¼Œæˆ‘ä»¬æœ‰æœºä¼šè·³è¿‡æ›´å¤šçš„å­—ç¬¦ï¼Œè¯·ç»§ç»­çœ‹ä¸‹å»ã€‚</p>

<p><strong>è§‚å¯Ÿ3(b)</strong>ï¼š</p>

<p>å¦‚æœæˆ‘ä»¬çŸ¥é“$string$æ¥ä¸‹æ¥çš„$m$ä¸ªå­—ç¬¦å’Œ$pat$çš„æœ€å$m$ä¸ªå­—ç¬¦åŒ¹é…ï¼Œå‡è®¾è¿™ä¸ªå­ä¸²ä¸º$subpat$ï¼Œ</p>

<p>æˆ‘ä»¬è¿˜çŸ¥é“åœ¨$string$å¤±é…å­—ç¬¦$char$åé¢æ˜¯ä¸$subpat$ç›¸åŒ¹é…çš„å­ä¸²ï¼Œè€Œå‡å¦‚$pat$å¯¹åº”å¤±é…å­—ç¬¦å‰é¢å­˜åœ¨$subpat$ï¼Œæˆ‘ä»¬å¯ä»¥å°†$pat$å‘ä¸‹æ»‘åŠ¨ä¸€æ®µè·ç¦»ï¼Œ</p>

<p>ä½¿å¾—å¤±é…å­—ç¬¦$char$åœ¨$pat$ä¸Šå¯¹åº”çš„å­—ç¬¦å‰é¢å‡ºç°çš„$subpat$ï¼ˆåˆç†é‡ç°ï¼Œplausible reoccurrenceï¼Œä»¥ä¸‹ä¹Ÿç®€ç§°prï¼‰ä¸$string$çš„$subpat$å¯¹é½ã€‚å¦‚æœ$pat$ä¸Šæœ‰å¤šä¸ª$subpat$ï¼ŒæŒ‰ç…§ä»å³åˆ°å·¦çš„åç¼€åŒ¹é…é¡ºåºï¼Œå–ç¬¬ä¸€ä¸ªï¼ˆrightmost plausible reoccurrenceï¼Œä»¥ä¸‹ä¹Ÿç®€ç§°rprï¼‰ã€‚</p>

<p>å‡è®¾æ­¤æ—¶$pat$å‘ä¸‹æ»‘åŠ¨çš„$k$ä¸ªå­—ç¬¦ï¼ˆä¹Ÿå³$pat$æœ«å°¾ç«¯çš„$subpat$ä¸å…¶æœ€å³è¾¹çš„åˆç†é‡ç°çš„è·ç¦»ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„æ³¨æ„åŠ›åº”è¯¥æ²¿ç€$string$å‘åæ»‘åŠ¨$k+m$ä¸ªå­—ç¬¦ï¼Œè¿™æ®µè·ç¦»æˆ‘ä»¬ç§°ä¹‹ä¸º$delta_2(j)$ï¼š</p>

<p>å‡å®š$rpr(j)$ ä¸º$subpat=pat[j+1\dots patlen-1]$åœ¨$pat[j]$æœ€å³è¾¹åˆç†é‡ç°çš„ä½ç½®ï¼ˆè¿™é‡Œåªç»™å‡ºç®€å•å®šä¹‰ï¼Œåœ¨ä¸‹æ–‡çš„ç®—æ³•è®¾è®¡ç« èŠ‚é‡Œä¼šæœ‰æ›´ç²¾ç¡®çš„è®¨è®ºï¼‰ï¼Œé‚£ä¹ˆæ˜¾ç„¶$k=j-rpr(j),\ m=patlen-1-j$ã€‚</p>

<p>æ‰€ä»¥æœ‰ï¼š</p>

\[\begin{array}{ll}
\textbf{int}\ delta2(\textbf{int}\ j) \quad\textbf{\\\\}\ \text{jä¸ºå¤±é…å­—ç¬¦åœ¨patä¸Šå¯¹åº”å­—ç¬¦çš„ä½ç½®} \\

\qquad\qquad\textbf{return}\ patlastpos-rpr(j) \\



\end{array}\]

<p>äºæ˜¯æˆ‘ä»¬åœ¨å¤±é…æ—¶ï¼Œå¯ä»¥æŠŠæŠŠ$string$ä¸Šçš„æ³¨æ„åŠ›å¾€åè·³è¿‡$\max(delta_1,delta_2)$ä¸ªå­—ç¬¦</p>

<h2 id="å®ä¾‹è¯´æ˜">å®ä¾‹è¯´æ˜ï¼š</h2>

<p>ç®­å¤´æŒ‡å‘å¤±é…å­—ç¬¦$char$ï¼š</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \, \, \Uparrow
\end{aligned}\]

<p>$\texttt{F}$æ²¡æœ‰å‡ºç°$pat$ä¸­ï¼Œæ ¹æ®<strong>è§‚å¯Ÿ1</strong>ï¼Œ$pat$ç›´æ¥å‘ä¸‹ç§»åŠ¨$patlen$ä¸ªå­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯7â€‹ä¸ªå­—ç¬¦:</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\quad\ \ \, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \, \, \qquad\quad\ \ \ \Uparrow
\end{aligned}\]

<p>æ ¹æ®<strong>è§‚å¯Ÿ2</strong>ï¼Œæˆ‘ä»¬éœ€è¦å°†$pat$å‘ä¸‹ç§»åŠ¨4ä¸ªå­—ç¬¦ä½¿å¾—çŸ­æ¨ªçº¿å­—ç¬¦å¯¹é½ï¼š</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\quad\ \ \, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad \Uparrow
\end{aligned}\]

<p>ç°åœ¨<em>char</em>:$\texttt{T}$åŒ¹é…äº†ï¼ŒæŠŠ$string$ä¸Šçš„æŒ‡é’ˆå·¦ç§»ä¸€æ­¥ç»§ç»­åŒ¹é…ï¼š</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\quad\ \ \, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\quad\ \, \Uparrow
\end{aligned}\]

<p>æ ¹æ®<strong>è§‚å¯Ÿ3(a)</strong>ï¼Œ$\texttt{L}$å¤±é…ï¼Œ å› ä¸º$\texttt{L}$ä¸åœ¨$pat$ä¸­ï¼Œæ‰€ä»¥$pa$tå‘ä¸‹ç§»åŠ¨$k=delta_1-m=7-1=6$ä¸ªå­—ç¬¦ï¼Œè€Œ$string$ä¸ŠæŒ‡é’ˆå‘ä¸‹ç§»åŠ¨$delta_1=7$ä¸ªå­—ç¬¦ï¼š</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\qquad\qquad\ \ \,\, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad\qquad\ \ \ \, \, \Uparrow
\end{aligned}\]

<p>è¿™æ—¶$char$åˆä¸€æ¬¡åŒ¹é…åˆ°äº†$pat$çš„æœ€åä¸€ä¸ªå­—ç¬¦$\texttt{T}$ï¼Œ$string$ä¸Šçš„æŒ‡é’ˆå‘å·¦åŒ¹é…ï¼ŒåŒ¹é…åˆ°äº†$\texttt{A}$ï¼Œç»§ç»­å‘å·¦åŒ¹é…ï¼Œå‘ç°åœ¨å­—ç¬¦$\texttt{-}$å¤±é…ï¼š</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\qquad\qquad\ \ \,\, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad\quad\ \ \ \,\, \Uparrow
\end{aligned}\]

<p>æ˜¾ç„¶ç›´è§‚ä¸Šçœ‹ï¼Œæ­¤æ—¶æ ¹æ®<strong>è§‚å¯Ÿ3(b)</strong>ï¼Œ å°†$pat$å‘å·¦ç§»åŠ¨$k=5$ä¸ªå­—ç¬¦ï¼Œä½¿å¾—åç¼€$\texttt{AT}$å¯¹é½ï¼Œè¿™ç§æ»‘åŠ¨å¯ä»¥è·å¾—$string$æŒ‡é’ˆæœ€å¤§çš„æ»‘åŠ¨è·ç¦»ï¼Œæ­¤æ—¶$delta_2=k+patlen-1-j=5+7-1-4=7$ï¼Œå³$string$ä¸ŠæŒ‡é’ˆå‘ä¸‹æ»‘åŠ¨7â€‹ä¸ªå­—ç¬¦ã€‚</p>

<p>è€Œä»å½¢å¼åŒ–é€»è¾‘çœ‹ï¼Œæ­¤æ—¶ï¼Œ$delta_1=7-1-2=4,\ delta_2=5, \max(delta_1,delta_2)= 7$ï¼Œ
è¿™æ ·ä»å½¢å¼é€»è¾‘ä¸Šæ”¯æŒäº†è¿›è¡Œ<strong>è§‚å¯Ÿ3(b)</strong>çš„è·³è½¬ï¼š</p>

\[\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\qquad\qquad\qquad\quad \;\, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad\qquad\qquad\quad \ \ \; \Uparrow
\end{aligned}\]

<p>ç°åœ¨æˆ‘ä»¬å‘ç°äº†$pat$ä¸Šæ¯ä¸€ä¸ªå­—ç¬¦éƒ½å’Œ$string$ä¸Šå¯¹åº”çš„å­—ç¬¦ç›¸ç­‰ï¼Œæˆ‘ä»¬åœ¨$string$ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ª$pat$çš„åŒ¹é…ã€‚è€Œæˆ‘ä»¬åªèŠ±è´¹äº†14æ¬¡å¯¹$string$çš„å¼•ç”¨ï¼Œå…¶ä¸­7æ¬¡æ˜¯å®Œæˆä¸€ä¸ªæˆåŠŸçš„åŒ¹é…æ‰€å¿…éœ€çš„æ¯”è¾ƒæ¬¡æ•°ï¼ˆ$patlen=7$ï¼‰ï¼Œå¦å¤–7æ¬¡è®©æˆ‘ä»¬è·³è¿‡äº†22ä¸ªå­—ç¬¦ï¼ŒAmazingï¼ˆæµ®å¤¸å£æ°”ï¼‰ï¼</p>

<h2 id="ç®—æ³•è®¾è®¡">ç®—æ³•è®¾è®¡</h2>

<h3 id="æœ€åˆçš„åŒ¹é…ç®—æ³•">æœ€åˆçš„åŒ¹é…ç®—æ³•</h3>

<p>ç°åœ¨çœ‹è¿™æ ·ä¸€ä¸ªåˆ©ç”¨$delta_1$å’Œ$delta_2$è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…çš„ç®—æ³•ï¼š</p>

\[\begin{array}{ll}
i \gets patlastpos. \\
j \gets patlastpos. \\

\textbf{loop}\\
\qquad \textbf{if}\ j &lt; 0 \\
\qquad \qquad \textbf{return}\ i+1 \\
\\
\qquad \textbf{if}\ string[i]=pat[j] \\
\qquad \qquad j \gets j-1 \\
\qquad \qquad i \gets i-1 \\
\qquad \qquad \textbf{continue} \\
\\
\qquad i \gets i+max(delta_1(string[i]), delta_2(j)) \\
\\
\qquad \textbf{if}\ i &gt; stringlastpos \\
\qquad \qquad \textbf{return}\ false \\
\qquad j \gets patlastpos \\
\end{array}\]

<p>å¦‚æœä¸Šé¢çš„ç®—æ³•$\textbf{return}\ false$ï¼Œ è¡¨æ˜$pat$ä¸åœ¨$string$ä¸­ï¼›å¦‚æœè¿”å›ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤º$pat$åœ¨$string$å·¦èµ·ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚</p>

<p>ç„¶åè®©æˆ‘ä»¬æ›´ç²¾ç»†åœ°æè¿°ä¸‹è®¡ç®—$delta_2$ï¼Œæ‰€ä¾é çš„$rpr(j)$å‡½æ•°ã€‚</p>

<p>æ ¹æ®å‰æ–‡å®šä¹‰ï¼Œ$rpr(j)$è¡¨ç¤ºåœ¨$pat(j)$å¤±é…æ—¶ï¼Œå­ä¸²$subpat=pat[j+1\dots patlastpos]$åœ¨$pat[j]$æœ€å³è¾¹åˆç†é‡ç°çš„ä½ç½®ã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæœ€å¥½çš„$k$, ä½¿å¾—$pat[k\dots k+patlastpos-j-1]=pat[j+1\dots patlastpos]$ï¼Œå¦å¤–è¦è€ƒè™‘ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼š</p>

<ol>
  <li>å½“$k&lt;0$æ—¶ï¼Œç›¸å½“äºåœ¨$pat$å‰é¢è¡¥å……äº†ä¸€æ®µè™šæ‹Ÿçš„å‰ç¼€ï¼Œå®é™…ä¸Šä¹Ÿç¬¦åˆ$delta_2$è·³è½¬çš„åŸç†</li>
  <li>å½“$k&gt;0$æ—¶ï¼Œ å¦‚æœ$pat[k-1]=pat[j]$ï¼Œåˆ™è¿™ä¸ª$pat[k\dots k+patlastpos-j-1]$ä¸èƒ½ä½œä¸º$subpat$çš„åˆç†é‡ç°ã€‚
åŸå› æ˜¯$pat[j]$æœ¬èº«æ˜¯å¤±é…å­—ç¬¦ï¼Œæ‰€ä»¥$pat$å‘ä¸‹æ»‘åŠ¨$k$ä¸ªå­—ç¬¦åï¼Œåœ¨åç¼€åŒ¹é…è¿‡ç¨‹ä¸­ä»ç„¶ä¼šåœ¨$pat[k-1]$å¤„å¤±é…ã€‚</li>
</ol>

<p>ç‰¹åˆ«åœ°ï¼Œè€ƒè™‘åˆ°$delta_2(patlastpos)= 0$ï¼Œ æ‰€ä»¥$rpr(patlastpos) = patlastpos$</p>

<p>ç”±äºç†è§£$rpr(j)$æ˜¯å®ç°BoyerMooreç®—æ³•çš„æ ¸å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªä¾‹å­è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼š</p>

\[\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8} \\
\textit{pat}:\qquad\qquad\ \  &amp;\texttt{A B C X X X A B C} \\
\textit{rpr(j)}:\qquad\quad\  \  &amp;\texttt{5 4 3 2 1 0 2 1 8} \\
\textit{sgn}:\qquad\qquad\ \   &amp;\texttt{- - - - - - - - +}
\end{aligned}\]

<p>å¯¹äº$rpr(0)$ï¼Œ$subpat$ä¸º$\texttt{BCXXXABC}$ï¼Œ åœ¨$pat[0]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(BCXXX)ABC]XXXABC}$ï¼Œä¹Ÿå°±æ˜¯æœ€å³è¾¹åˆç†é‡ç°ä½ç½®ä¸º -5ï¼Œ å³$rpr(j)=-5$ï¼›</p>

<p>å¯¹äº$rpr(1)$ï¼Œ$subpat$ä¸º$\texttt{CXXXABC}$ï¼Œåœ¨$pat[1]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[(CXXX)ABC]XXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=-4$ï¼›</p>

<p>å¯¹äº$rpr(2)$ï¼Œ$subpat$ä¸º$\texttt{XXXABC}$ï¼Œåœ¨$pat[2]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[(XXX)ABC]XXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=-3$ï¼›</p>

<p>å¯¹äº$rpr(3)$ï¼Œ$subpat$ä¸º$\texttt{XXABC}$ï¼Œåœ¨$pat[3]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[(XX)ABC]XXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=-2$ï¼›</p>

<p>å¯¹äº$rpr(4)$ï¼Œ$subpat$ä¸º$\texttt{XABC}$ï¼Œåœ¨$pat[4]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[(X)ABC]XXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=-1$ï¼›</p>

<p>å¯¹äº$rpr(5)$ï¼Œ$subpat$ä¸º$\texttt{ABC}$ï¼Œåœ¨$pat[5]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[ABC]XXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=0$ï¼›</p>

<p>å¯¹äº$rpr(6)$ï¼Œ$subpat$ä¸º$\texttt{BC}$ï¼Œåˆå› ä¸º$string[0]=string[6]$ï¼Œå³$string[0]$ç­‰äºå¤±é…å­—ç¬¦$string[6]$ï¼Œæ‰€ä»¥$string[0\dots 2]$ å¹¶ä¸æ˜¯ç¬¦åˆæ¡ä»¶çš„$subpat$çš„åˆç†é‡ç°ï¼Œæ‰€ä»¥åœ¨æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[(BC)]ABCXXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=-2$ï¼›</p>

<p>å¯¹äº$rpr(7)$ï¼Œ$subpat$ä¸º$\texttt{C}$ï¼ŒåŒç†åˆå› ä¸º$string[7]=string[1]$ï¼Œæ‰€ä»¥$string[1\dots 2]$ å¹¶ä¸æ˜¯ç¬¦åˆæ¡ä»¶çš„subpatçš„åˆç†é‡ç°ï¼Œåœ¨æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[(C)]ABCXXXABC}$ï¼Œæ‰€ä»¥$rpr(j)=-1$ï¼›</p>

<p>å¯¹äº$rpr(8)$ï¼Œæ ¹æ®$delta_2$å®šä¹‰ï¼Œ$rpr(patlastpos)=patlastpos$ï¼Œå¾—åˆ°$rpr(8)=8$ã€‚</p>

<p>ç°åœ¨å†çœ‹ä¸€ä¸‹å¦ä¸€ä¸ªä¾‹å­ï¼š</p>

\[\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8} \\
\textit{pat}:\qquad\qquad\ \ &amp;\texttt{A B Y X C D E Y X} \\
\textit{rpr(j)}:\qquad\quad\  \  &amp;\texttt{8 7 6 5 4 3 2 1 8} \\
\textit{sgn}:\qquad\qquad\ \   &amp;\texttt{- - - - - - + - +}
\end{aligned}\]

<p>å¯¹äº$rpr(0)$ï¼Œ$subpat$ä¸º$\texttt{BYXCDEYX}$ï¼Œ åœ¨$pat[0]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(BYXCDEYX)]ABYXCDEYX}$ï¼Œä¹Ÿå°±æ˜¯æœ€å³è¾¹åˆç†é‡ç°ä½ç½®ä¸º -8ï¼Œ å³$rpr(j)=-8$ï¼›</p>

<p>å¯¹äº$rpr(1)$ï¼Œ$subpat$ä¸º$\texttt{YXCDEYX}$ï¼Œ åœ¨$pat[1]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(YXCDEYX)]ABYXCDEYX}$ ï¼Œ$rpr(j)=-7$ï¼›</p>

<p>å¯¹äº$rpr(2)$ï¼Œ$subpat$ä¸º$\texttt{XCDEYX}$ï¼Œ åœ¨$pat[2]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(XCDEYX)]ABYXCDEYX}$ï¼Œ$rpr(j)=-6$ï¼›</p>

<p>å¯¹äº$rpr(3)$ï¼Œ$subpat$ä¸º$\texttt{CDEYX}$ï¼Œ åœ¨$pat[3]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(CDEYX)]ABYXCDEYX}$ï¼Œ$rpr(j)=-5$ï¼›</p>

<p>å¯¹äº$rpr(4)$ï¼Œ$subpat$ä¸º$\texttt{DEYX}$ï¼Œ åœ¨$pat[4]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(DEYX)]ABYXCDEYX}$ï¼Œ$rpr(j)=-4$ï¼›</p>

<p>å¯¹äº$rpr(5)$ï¼Œ$subpat$ä¸º$\texttt{EYX}$ï¼Œ åœ¨$pat[5]$ä¹‹å‰çš„æœ€å³è¾¹åˆç†é‡ç°åªèƒ½æ˜¯$\texttt{[(EYX)]ABYXCDEYX}$ ï¼Œ$rpr(j)=-3$ï¼›</p>

<p>å¯¹äº$rpr(6)$ï¼Œ$subpat$ä¸º$\texttt{YX}$ï¼Œ å› ä¸º$string[2\dots 3]=string[7\dots 8]$ å¹¶ä¸”æœ‰$string[6]\neq string[1]$ï¼Œæ‰€ä»¥åœ¨$pat[6]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{AB[YX]CDEYX}$ ï¼Œ$rpr(j)=2$ï¼›</p>

<p>å¯¹äº$rpr(7)$ï¼Œ$subpat$ä¸º$\texttt{X}$ï¼Œ è™½ç„¶$string[3]=string[8]$ ä½†æ˜¯å› ä¸º$string[2] = string[7]$ï¼Œæ‰€ä»¥åœ¨$pat[7]$ä¹‹å‰çš„æœ€å³è¾¹çš„åˆç†é‡ç°æ˜¯$\texttt{[X]ABYXCDEYX}$ ï¼Œ$rpr(j)=-1$;</p>

<p>å¯¹äº$rpr(8)$ï¼Œæ ¹æ®$delta_2$å®šä¹‰ï¼Œ$rpr(patlastpos)=patlastpos$ï¼Œå¾—åˆ°$rpr(8)=8$ã€‚</p>

<h3 id="å¯¹åŒ¹é…ç®—æ³•çš„ä¸€ä¸ªæ”¹è¿›">å¯¹åŒ¹é…ç®—æ³•çš„ä¸€ä¸ªæ”¹è¿›</h3>

<p>æœ€åï¼Œå®è·µè¿‡ç¨‹ä¸­è€ƒè™‘åˆ°æœç´¢è¿‡ç¨‹ä¸­ä¼°è®¡æœ‰80%çš„æ—¶é—´ç”¨åœ¨äº†åŸºäº<strong>è§‚å¯Ÿ1</strong>çš„è·³è½¬ä¸Šï¼Œä¹Ÿå°±æ˜¯$string[i]$å’Œ$pat[patlastpos]$ä¸åŒ¹é…ï¼Œç„¶åè·³è¶Šæ•´ä¸ª$patlen$è¿›è¡Œä¸‹ä¸€æ¬¡åŒ¹é…çš„è¿‡ç¨‹ã€‚</p>

<p>äºæ˜¯ï¼Œå¯ä»¥ä¸ºæ­¤è¿›è¡Œç‰¹åˆ«çš„ä¼˜åŒ–ï¼š</p>

<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª$delta0$ï¼š</p>

\[\begin{array}{ll}
\textbf{int}\ delta0(\textbf{char}\ char) \\
\qquad \textbf{if}\ char=pat[patlastpos] \\
\qquad\qquad \textbf{return}\ large\ \ \text{\\\\ largeä¸ºä¸€ä¸ªæ•´æ•°ï¼Œéœ€è¦æ»¡è¶³large&gt;stringlastpos+patlen} \\
\qquad \textbf{return}\ delta1(char)
\end{array}\]

<p>ç”¨$delta0$ä»£æ›¿$delta_1$ï¼Œå¾—åˆ°æ”¹è¿›åçš„åŒ¹é…ç®—æ³•:</p>

\[\begin{array}{ll}
i \gets patlastpos \\
\textbf{loop} \\
\qquad\textbf{if} \ i &gt; stringlastpos \\
\qquad\qquad\textbf{return}\ false\\
\\
\qquad\textbf{while}\ i &lt; stringlen \\
\qquad\qquad i \gets i+delta0(string(i)) \ \ \text{\\\\ é™¤éstring[i]å’Œpatæœ«å°¾å­—ç¬¦åŒ¹é…ï¼Œå¦åˆ™è‡³å¤šå‘ä¸‹æ»‘åŠ¨patlen }\\\
\qquad\textbf{if}\ i \leqslant\ large \qquad\qquad\qquad\qquad \text{\\\\æ­¤æ—¶è¡¨ç¤ºstringä¸Šæ²¡æœ‰ä¸€ä¸ªå­—ç¬¦å’Œpatæœ«å°¾å­—ç¬¦åŒ¹é…}\ \\
\qquad\qquad\textbf{return}\ false\\
\\
\qquad i \gets i-large \\
\qquad j \gets patlastpos. \\

\qquad\textbf{while}\ j \geqslant\ 0 \ and \  string[i]=pat[j]\\
\qquad \qquad j \gets j-1 \\
\qquad \qquad i \gets i-1 \\

\\
\qquad \textbf{if}\ j &lt; 0 \\
\qquad \qquad \textbf{return}\ i+1 \\
\qquad i \gets i+max(delta_1(string[i]), delta_2(j)) \\
\\

\end{array}\]

<p>ç»è¿‡æ”¹è¿›ï¼Œæ¯”èµ·åŸç®—æ³•ï¼Œåœ¨åš<strong>è§‚å¯Ÿ1</strong>è·³è½¬æ—¶ä¸å¿…æ¯æ¬¡è¿›è¡Œ$delta_2$çš„å¤šä½™è®¡ç®—ï¼Œä½¿å¾—åœ¨é€šå¸¸å­—ç¬¦é›†ä¸‹æœç´¢å­—ç¬¦ä¸²çš„æ€§èƒ½æœ‰äº†æ˜æ˜¾çš„æå‡ã€‚</p>

<h2 id="delta_2æ„å»ºç»†èŠ‚">$delta_2$æ„å»ºç»†èŠ‚</h2>

<h3 id="å†å²ç»†èŠ‚">å†å²ç»†èŠ‚</h3>

<p>è¯´èµ·$delta_2$çš„å®ç°ï¼Œå‘è¡¨åœ¨1977å¹´10æœˆçš„<em>Communications of the ACM</em>ä¸Šçš„åœ¨Boyerã€Moorçš„è®ºæ–‡<sup id="fnref:1977BM" role="doc-noteref"><a href="#fn:1977BM" class="footnote" rel="footnote">1</a></sup>é‡Œåªæè¿°äº†è¿™ä¸ªé™æ€è¡¨ï¼Œå¹¶æ²¡æœ‰è¯´æ˜å¦‚ä½•äº§ç”Ÿå®ƒã€‚</p>

<p>è€Œæ„é€ $delta_2$çš„å…·ä½“å®ç°çš„è®¨è®ºå‡ºç°åœ¨1977å¹´6æœˆKnuthã€Morrisã€Prattåœ¨<em>SIAM Journal on Computing</em>ä¸Šæ­£å¼è”åˆå‘è¡¨çš„KMPç®—æ³•çš„[è®ºæ–‡][1977KMP]é‡Œï¼ˆè¿™ç¯‡è®ºæ–‡æ˜¯ä¸ªå®è—ï¼Œé™¤äº†KMPï¼Œå…¶ä¸­è¿˜æåŠäº†è‹¥å¹²å­—ç¬¦ä¸²æœç´¢çš„ç®—æ³•æ„æƒ³å’Œä»‹ç»ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº†æœ¬æ–‡ä»‹ç»çš„BMç®—æ³•ï¼‰ï¼Œå¬åŠ›æ¥æœ‰ç‚¹å„¿é­”å¹»ï¼Œå—¯å“¼ï¼Ÿè¿™å°±ä¸å¾—ä¸ç¨å¾®ä»‹ç»ä¸€ç‚¹å†å²ç»†èŠ‚äº†ï¼š</p>

<ol>
  <li>
    <p>1969å¹´å¤å¤©Morrisä¸ºæŸä¸ªå¤§å‹æœºç¼–å†™æ–‡æœ¬ç¼–è¾‘å™¨æ—¶åˆ©ç”¨æœ‰é™è‡ªåŠ¨æœºçš„ç†è®ºå‘æ˜äº†ç­‰ä»·äºKMPç®—æ³•çš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œè€Œä»–çš„ç®—æ³•ç”±äºè¿‡äºå¤æ‚ï¼Œè¢«ä¸ç†è§£ä»–ç®—æ³•çš„åŒäº‹å½“åšbugä¿®æ”¹å¾—ä¸€å›¢ç³Ÿï¼Œå“ˆå“ˆã€‚</p>
  </li>
  <li>
    <p>1970å¹´KMPä¸­çš„â€œå¸¦å¤´äººâ€Kruthåœ¨ç ”ç©¶Cookçš„å…³äºä¸¤è·¯ç¡®å®šä¸‹æ¨è‡ªåŠ¨æœºï¼ˆtwo-way deterministic pushdown automatonï¼‰çš„ç†è®ºæ—¶å—åˆ°å¯å‘ï¼Œä¹Ÿç‹¬ç«‹å‘æ˜äº†KMPç®—æ³•çš„é›å½¢ï¼Œå¹¶æŠŠå®ƒå±•ç¤ºç»™ä»–çš„åŒäº‹Prattï¼ŒPrattæ”¹è¿›äº†ç®—æ³•çš„æ•°æ®ç»“æ„ã€‚</p>
  </li>
  <li>
    <p>1974å¹´Boyerã€Moorå‘ç°é€šè¿‡æ›´å¿«åœ°è·³è¿‡ä¸å¯èƒ½åŒ¹é…çš„æ–‡æœ¬èƒ½å®ç°æ¯”KMPæ›´å¿«çš„å­—ç¬¦ä¸²åŒ¹é…ï¼Œï¼ˆ Gosperä¹Ÿç‹¬ç«‹åœ°å‘ç°äº†è¿™ä¸€ç‚¹ï¼‰ï¼Œè€Œä¸€ä¸ªåªæœ‰åŸå§‹$delta_1$</p>

    <p>å®šä¹‰çš„åŒ¹é…ç®—æ³•æ˜¯BMç®—æ³•çš„æœ€åŸå§‹ç‰ˆæœ¬ã€‚</p>
  </li>
  <li>
    <p>1975å¹´Boyerã€Mooræå‡ºäº†åŸå§‹çš„$delta_2$è¡¨ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬çš„$delta_2$è¡¨ä¸ä»…ä¸ä¼šå¯¹æ€§èƒ½æœ‰æ‰€æ”¹å–„ï¼Œè¿˜ä¼šåœ¨å¤„ç†å°å­—ç¬¦è¡¨æ—¶æ‹–ç´¯æ€§èƒ½è¡¨ç°ï¼Œè€ŒåŒå¹´MITäººå·¥æ™ºèƒ½å®éªŒå®¤çš„Kuiperså’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„Knuthå‘ä»–ä»¬æå‡ºäº†ç±»ä¼¼çš„å…³äº$delta_2$çš„æ”¹è¿›å»ºè®®ï¼Œäºæ˜¯Boyerã€Mooråœ¨è®ºæ–‡çš„ä¸‹ä¸€æ¬¡ä¿®æ”¹ä¸­æåˆ°äº†è¿™ä¸ªå»ºè®®ï¼Œå¹¶æå‡ºä¸€ä¸ªç”¨äºŒç»´è¡¨ä»£æ›¿$delta_1$å’Œ$delta_2$çš„æƒ³æ³•ã€‚</p>
  </li>
  <li>
    <p>1976å¹´1æœˆKnuthè¯æ˜äº†å…³äº$delta_2$çš„æ”¹è¿›ä¼šå¾—åˆ°æ›´å¥½çš„æ€§èƒ½ï¼Œäºæ˜¯Boyerã€Moorä¸¤äººåˆä¸€æ¬¡ä¿®æ”¹äº†è®ºæ–‡ï¼Œå¾—åˆ°äº†ç°åœ¨ç‰ˆæœ¬çš„$delta_2$å®šä¹‰ã€‚åŒå¹´4æœˆï¼Œæ–¯å¦ç¦çš„Floydåˆå‘ç°äº†Boyerã€Moorä¸¤äººç¬¬ä¸€ç‰ˆæœ¬çš„å…¬å¼ä¸­çš„ä¸¥é‡çš„ç»Ÿè®¡é”™è¯¯ï¼Œå¹¶ç»™å‡ºäº†ç°åœ¨ç‰ˆæœ¬çš„å…¬å¼ã€‚</p>
  </li>
  <li>
    <p>Standishåˆä¸ºBoyerã€Mooræä¾›äº†ç°åœ¨çš„åŒ¹é…ç®—æ³•çš„æ”¹è¿›ã€‚</p>
  </li>
  <li>
    <p>1977å¹´6æœˆKnuthã€Morrisã€Prattæ­£å¼è”åˆå‘è¡¨äº†KMPç®—æ³•çš„è®ºæ–‡ï¼Œå…¶ä¸­åœ¨æåŠæ¯”KMPè¡¨ç°æ›´å¥½çš„ç®—æ³•ä¸­æå‡ºäº†$delta_2$çš„æ„å»ºæ–¹å¼ã€‚ï¼ˆå…¶ä¸­ä¹Ÿæ„Ÿè°¢äº†Boyerã€ Moorå¯¹äºè¯æ˜çº¿æ€§å®šç†ï¼ˆlinearity theoremï¼‰æä¾›çš„å¸®åŠ©ï¼‰</p>
  </li>
</ol>

<p>è¿™ä¸ªBMç®—æ³•çš„å‘å±•çš„æ•…äº‹ï¼Œåˆ‡å®åœ°å‘æˆ‘ä»¬å±•ç¤ºäº†å›¢ç»“ã€å‹è°Šã€åä½œï¼Œä»¥åŠè°¦è™šå¥½å­¦ä¸æŠ˜ä¸æŒ â€œåœ¨å¹³å‡¡ä¸­å®ç°ä¼Ÿå¤§â€ï¼ğŸ˜‚ğŸ˜‚ğŸ˜‚</p>

<h3 id="æ—¶é—´å¤æ‚åº¦ä¸ºon3-çš„æ„å»ºdelta_2çš„æœ´ç´ ç®—æ³•">æ—¶é—´å¤æ‚åº¦ä¸º$O(n^3)$ çš„æ„å»ºdelta_2çš„æœ´ç´ ç®—æ³•</h3>

<p>åœ¨ä»‹ç»Knuthçš„$delta_2$æ„å»ºç®—æ³•ä¹‹å‰ï¼Œæ ¹æ®å®šä¹‰ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªåŸå§‹ã€ç®€å•ä½†æœ‰æ—¶å¯èƒ½å·²ç»å¤Ÿç”¨çš„æœ´ç´ ç®—æ³•ï¼ˆé™¤éä½ éœ€è¦æ„å»ºé•¿åº¦æˆç™¾ä¸Šåƒçš„$pat$ï¼‰ï¼š</p>

<ol>
  <li>å¯¹äº<code class="language-plaintext highlighter-rouge">[0, patlen)</code>åŒºé—´çš„æ¯ä¸€ä¸ªä½ç½®ï¼Œæ ¹æ®<code class="language-plaintext highlighter-rouge">subpat</code>çš„é•¿åº¦ç¡®å®šå…¶é‡ç°ä½ç½®çš„åŒºé—´ï¼Œä¹Ÿå°±æ˜¯<code class="language-plaintext highlighter-rouge">[-subpatlen..i)</code>ï¼›</li>
  <li>å¯èƒ½çš„é‡ç°ä½ç½®æŒ‰ç…§ä»å³åˆ°å·¦è¿›è¡Œé€å­—ç¬¦æ¯”è¾ƒï¼Œå¯»æ‰¾ç¬¦åˆ$delta_2$è¦æ±‚çš„æœ€å³è¾¹$subpat$çš„é‡ç°ä½ç½®ï¼›</li>
  <li>æœ€ååˆ«å¿˜äº†ä»¤$delta_2(lastpos)= 0$ã€‚</li>
</ol>

<pre><code class="language-Rust">use std::cmp::PartialEq;

pub fn build_delta_2_table_naive(p: &amp;[impl PartialEq]) -&gt; Vec&lt;usize&gt; {
    let patlen = p.len();
    let lastpos = patlen - 1;
    let mut delta_2 = vec![];

    for i in 0..patlen {
        let subpatlen = (lastpos - i) as isize;

        if subpatlen == 0 {
            delta_2.push(0);
            break;
        }

        for j in (-subpatlen..(i + 1) as isize).rev() {
            // subpat åŒ¹é…
            if (j..j + subpatlen)
            .zip(i + 1..patlen)
            .all(|(rpr_index, subpat_index)| {
                if rpr_index &lt; 0 {
                    return true;
                }

                if p[rpr_index as usize] == p[subpat_index] {
                    return true;
                }

                false
            })
            &amp;&amp; (j &lt;= 0 || p[(j - 1) as usize] != p[i])
            {
                delta_2.push((lastpos as isize - j) as usize);
                break;
            }
        }
    }

    delta_2
}
</code></pre>

<p>ç‰¹åˆ«åœ°ï¼Œå¯¹Rustè¯­è¨€ç‰¹æ€§è¿›è¡Œå¿…è¦åœ°è§£é‡Šï¼Œä¸‹ä¸èµ˜è¿°ï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">usize</code>å’Œ<code class="language-plaintext highlighter-rouge">isize</code>æ˜¯å’Œå†…å­˜æŒ‡é’ˆåŒå­—èŠ‚æ•°çš„æ— ç¬¦å·æ•´æ•°å’Œæœ‰ç¬¦å·æ•´æ•°ï¼Œåœ¨32ä½æœºä¸Šç›¸å½“äº<code class="language-plaintext highlighter-rouge">u32</code>å’Œ<code class="language-plaintext highlighter-rouge">i32</code>ï¼Œ64ä½æœºä¸Šç›¸å½“äº<code class="language-plaintext highlighter-rouge">u64</code>å’Œ<code class="language-plaintext highlighter-rouge">i64</code>ã€‚</li>
  <li>ç´¢å¼•æ•°ç»„ã€å‘é‡ã€åˆ†ç‰‡æ—¶ä½¿ç”¨<code class="language-plaintext highlighter-rouge">usize</code>ç±»å‹çš„æ•°å­—ï¼ˆå› ä¸ºåœ¨åšå†…å­˜ä¸Šçš„éšæœºè®¿é—®å¹¶ä¸”ä¸‹æ ‡ä¸èƒ½ä¸ºè´Ÿå€¼ï¼‰ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å¤„ç†è´Ÿå€¼è¦ç”¨<code class="language-plaintext highlighter-rouge">isize</code>ï¼Œè€Œè¿›è¡Œç´¢å¼•æ—¶åˆè¦ç”¨<code class="language-plaintext highlighter-rouge">usize</code>ï¼Œè¿™å°±çœ‹åˆ°ä½¿ç”¨<code class="language-plaintext highlighter-rouge">as</code>å…³é”®å­—è¿›è¡ŒäºŒè€…ä¹‹é—´çš„æ˜¾å¼è½¬æ¢ã€‚</li>
  <li><code class="language-plaintext highlighter-rouge">impl PartialEq</code> åªæ˜¯ç”¨ä½œæ³›å‹ï¼Œå¯ä»¥åŒæ—¶æ”¯æŒ<code class="language-plaintext highlighter-rouge">Unicode</code>ç¼–ç çš„<code class="language-plaintext highlighter-rouge">char</code>å’ŒäºŒè¿›åˆ¶çš„<code class="language-plaintext highlighter-rouge">u8</code>ã€‚</li>
</ul>

<p>æ˜¾è§è¿™æ˜¯ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º$O(n^3)$çš„æš´åŠ›ç®—æ³•ã€‚</p>

<h3 id="æ—¶é—´å¤æ‚åº¦ä¸ºonçš„æ„å»ºdelta_2çš„é«˜æ•ˆç®—æ³•">æ—¶é—´å¤æ‚åº¦ä¸º$O(n)$çš„æ„å»º$delta_2$çš„é«˜æ•ˆç®—æ³•</h3>

<p>ä¸‹é¢æˆ‘ä»¬è¦ä»‹ç»çš„æ˜¯æ—¶é—´å¤æ‚åº¦ä¸º$O(n)$ï¼Œä½†æ˜¯éœ€è¦é¢å¤–$O(n)$ç©ºé—´å¤æ‚åº¦çš„é«˜æ•ˆç®—æ³•ã€‚</p>

<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè™½ç„¶1977å¹´Knuthæå‡ºäº†è¿™ä¸ªæ„å»ºæ–¹æ³•ï¼Œç„¶è€Œä»–çš„åŸå§‹ç‰ˆæœ¬çš„æ„å»ºç®—æ³•å­˜åœ¨ä¸€ä¸ªç¼ºé™·ï¼Œå®é™…ä¸Šå¯¹äºæŸäº›$pat$äº§ç”Ÿä¸å‡ºç¬¦åˆå®šä¹‰çš„$delta_2$ã€‚</p>

<p>Rytteråœ¨1980å¹´<em>SIAM Journal on Computing</em>ä¸Šå‘è¡¨çš„æ–‡ç« <sup id="fnref:1980Rytter" role="doc-noteref"><a href="#fn:1980Rytter" class="footnote" rel="footnote">2</a></sup>å¯¹æ­¤æå‡ºäº†ä¿®æ­£ï¼Œä½†æ˜¯Rytterçš„è¿™ç¯‡æ–‡ç« åœ¨ç»†èŠ‚ä¸Šæœ‰äº›ä»¤äººç–‘æƒ‘çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬ä¸é™äº:</p>

<ul>
  <li>ç¤ºä¾‹ä¸­å¥‡æ€ªçš„$delta_2$æ•°å€¼ï¼ˆä¸æ¸…æ¥šä»–ä¾æ®çš„$delta_2$æ˜¯å¦å’Œæœ€ç»ˆç‰ˆ$delta_2$å®šä¹‰æœ‰å¾®å¦™çš„å·®åˆ«ï¼Œä½†æˆ‘å®åœ¨ä¸æƒ³å› ä¸ºè¿™äº‹å„¿ç»§ç»­è€ƒå¤äº†ğŸ˜±ï¼‰</li>
  <li>æ˜æ˜¾çš„åœ¨å¤è¿°Knuthç®—æ³•æ—¶çš„ç¬”è¯¯ã€ç®—æ³•ä¸Šé”™è¯¯çš„ç¼©è¿›ï¼ˆå¯èƒ½æ˜¯æ–‡ç« å½•å…¥æ—¶çš„é—®é¢˜ï¼Ÿï¼‰</li>
  <li>å¥‡å¦™çš„å˜é‡å‘½åï¼ˆè€ƒè™‘åˆ°é‚£ä¸ªæ—¶ä»£çš„æ ‡ç­¾ï¼š<code class="language-plaintext highlighter-rouge">goto</code>è¯­å¥ã€æ±‡ç¼–è¯­è¨€ã€å¤§å‹æœºï¼Œéšæ€§çš„å˜é‡å‘½åä¹Ÿå¾ˆåˆç†ï¼‰</li>
</ul>

<p>æ€»ä¹‹å°±æ˜¯ä½ ç»å¯¹ä¸æƒ³çœ‹ä»–çš„é‚£ä¸ªä¿®æ­£ç®—æ³•çš„å…·ä½“å®ç°ï¼Œä¸è¿‡å¥½åœ¨ä»–åœ¨ç”¨æ–‡å­—æè¿°çš„æ—¶å€™æ¯”ç”¨ä¼ªä»£ç æ¸…æ™°å¤šäº†å‘¢ï¼Œç°åœ¨æˆ‘ä»¬ç”¨æ›´æ¸…æ™°çš„æ€è·¯å’Œä»£ç ç»“æ„æ•´ç†è¿™ä¹ˆä¸€ä¸ª</p>

<p>$delta_2$çš„æ„å»ºç®—æ³•ï¼š</p>

<p>é¦–å…ˆè€ƒè™‘åˆ°$delta_2$çš„å®šä¹‰æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬æŒ‰ç…§$subpat$çš„é‡ç°ä½ç½®è¿›è¡Œåˆ†ç±»ï¼Œæ¯ä¸€ç±»è¿›è¡Œå•ç‹¬å¤„ç†ï¼Œè¿™æ˜¯é«˜æ•ˆå®ç°çš„å…³é”®æ€è·¯ã€‚</p>

<p>æŒ‰ç…§é‡ç°ä½ç½®ç”±è¿œåˆ°è¿‘ï¼Œä¹Ÿå°±æ˜¯åç§»é‡ç”±å¤§åˆ°å°ï¼Œåˆ†æˆå¦‚ä¸‹å‡ ç±»ï¼š</p>

<ol>
  <li>
    <p>æ•´ä¸ª$subpat$é‡ç°ä½ç½®å®Œå…¨åœ¨$pat$å·¦è¾¹çš„ï¼Œæ¯”å¦‚ $\texttt{[(EYX)]ABYXCDEYX}$ï¼Œ æ­¤æ—¶$delta_2(j) = patlastpos\times 2 - j$ï¼›</p>
  </li>
  <li>
    <p>$subpat$çš„é‡ç°æœ‰ä¸€éƒ¨åˆ†åœ¨$pat$å·¦è¾¹ï¼Œæœ‰ä¸€éƒ¨åˆ†æ˜¯$pat$å¤´éƒ¨ï¼Œæ¯”å¦‚$\texttt{[(XX)ABC]XXXABC}$ï¼Œæ­¤æ—¶$patlastpos &lt; delta_2(j) &lt; patlastpos\times 2 - j$ï¼›</p>

    <p>æˆ‘ä»¬æŠŠ$subpat$å®Œå…¨åœ¨$pat$å¤´éƒ¨çš„çš„è¾¹é™…æƒ…å†µä¹Ÿå½’ç±»åœ¨è¿™é‡Œï¼ˆå½“ç„¶æ ¹æ®å®ç°ä¹Ÿå¯ä»¥å½’ç±»åœ¨ä¸‹è¾¹ï¼‰ï¼Œæ¯”å¦‚$\texttt{[ABC]XXXABC}$ï¼Œæ­¤æ—¶$patlastpos = delta_2(j)$ï¼›</p>
  </li>
  <li>
    <p>$subpat$çš„é‡ç°å®Œå…¨åœ¨$pat$ä¸­ï¼Œæ¯”å¦‚$\texttt{AB[YX]CDEYX}$ ï¼Œæ­¤æ—¶$delta_2(j) &lt; patlastpos$ã€‚</p>
  </li>
</ol>

<p>ç°åœ¨æ¥è®¨è®ºå¦‚ä½•é«˜æ•ˆåœ°è®¡ç®—è¿™ä¸‰ç§æƒ…å†µï¼š</p>

<h4 id="ç¬¬ä¸€ç§æƒ…å†µ">ç¬¬ä¸€ç§æƒ…å†µ</h4>

<p>è¿™æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼Œåªéœ€ä¸€æ¬¡éå†å¹¶ä¸”å¯ä»¥é¡ºä¾¿å°†$delta_2$åˆå§‹åŒ–ã€‚</p>

<h4 id="ç¬¬äºŒç§æƒ…å†µ">ç¬¬äºŒç§æƒ…å†µ</h4>

<p>æˆ‘ä»¬è§‚å¯Ÿä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°$subpat$çš„é‡ç°ä¸€éƒ¨åˆ†åœ¨$pat$å·¦è¾¹ï¼Œä¸€éƒ¨åˆ†æ˜¯$pat$çš„å¤´éƒ¨çš„æƒ…å†µå‘¢ï¼Ÿåº”è¯¥æ˜¯$subpat$çš„æŸä¸ªåç¼€å’Œ$pat$çš„æŸä¸ªå‰ç¼€ç›¸ç­‰ï¼Œ</p>

<p>æ¯”å¦‚ä¹‹å‰çš„ä¾‹å­ï¼š</p>

\[\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8} \\
\textit{pat}:\qquad\qquad\ \  &amp;\texttt{A B C X X X A B C} \\
\end{aligned}\]

<p>$delta_2(3)$çš„é‡ç°$\texttt{[(XX)ABC]XXXABC}$ï¼Œsubpat$\texttt{XXABC}$ çš„åç¼€ä¸patå‰ç¼€ä¸­ï¼Œæœ‰ç›¸ç­‰çš„ï¼Œæ˜¯$\texttt{ABC}$ã€‚</p>

<p><em>è¯´åˆ°è¿™ä¸ªæ‹—å£çš„å‰ç¼€åç¼€ç›¸ç­‰ï¼Œæ­¤æ—¶çœ‹è¿‡ä¹‹å‰ã€Šå‰ç¼€å‡½æ•°ä¸KMPç®—æ³•ã€‹çš„å°ä¼™ä¼´ä»¬å¯èƒ½å·²ç»æœ‰æ‰€æ‚Ÿäº†ï¼Œ</em></p>

<p><em>æ²¡é”™ï¼Œå®é™…ä¸Šå¯¹ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æƒ…å†µçš„è®¡ç®—çš„å…³é”®éƒ½ç¦»ä¸å¼€å‰ç¼€å‡½æ•°çš„è®¡ç®—å’Œå’Œåº”ç”¨</em></p>

<p>é‚£ä¹ˆåªè¦$j$ å–å€¼ä½¿å¾—$subpat$åŒ…å«è¿™ä¸ªç›¸ç­‰çš„åç¼€ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°ç¬¬äºŒç§æƒ…å†µçš„$subpat$çš„é‡ç°ï¼Œå¯¹äºä¾‹å­ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿å¾—$j \leqslant 5$ï¼Œ</p>

<p>è€Œå½“$j = 5$æ—¶ï¼Œå°±æ˜¯$subpat$å®Œå…¨åœ¨$pat$å¤´éƒ¨çš„è¾¹é™…æƒ…å†µã€‚</p>

<p>å¯ä»¥è®¡ç®—æ­¤æ—¶çš„$delta_2(j)$ï¼š</p>

<p>è®¾æ­¤æ—¶è¿™å¯¹ç›¸ç­‰çš„å‰åç¼€é•¿åº¦ä¸º$\textit{prefixlen}$ï¼Œå¯çŸ¥$subpatlen = patlastpos - j$ï¼Œé‚£ä¹ˆåœ¨$pat$å·¦è¾¹çš„éƒ¨åˆ†é•¿åº¦æ˜¯$subpatlen-\textit{prefixlen}$ï¼Œ</p>

<p>è€Œ$rpr(j) = -(subpatlen-\textit{prefixlen})$ï¼Œæ‰€ä»¥å¾—åˆ°$delta_2(j) = patlastpos - rpr(j) = patlastpos \times 2 - j - \textit{prefixlen}$ã€‚</p>

<p>é‚£ä¹ˆé—®é¢˜åˆ°è¿™å„¿æ˜¯ä¸æ˜¯ç»“æŸäº†å‘¢ï¼Œå¹¶ä¸æ˜¯ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰å¤šå¯¹ç›¸ç­‰çš„å‰ç¼€å’Œåç¼€ï¼Œæ¯”å¦‚ï¼š</p>

\[\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8 9} \\
\textit{pat}:\qquad\qquad\ \  &amp;\texttt{A B A A B A A B A A} \\
\end{aligned}\]

<p>åœ¨$j\leq2$å¤„æœ‰$\texttt{ABAABAA}$ï¼Œ$2&lt; j \leq 5$å¤„æœ‰$\texttt{ABAA}$ï¼Œåœ¨$5&lt;j\leq8$å¤„æœ‰$\texttt{A}$</p>

<p>ä¹‹å‰æåˆ°çš„Knuthç®—æ³•çš„ç¼ºé™·å°±æ˜¯åªè€ƒè™‘äº†æœ€é•¿çš„é‚£ä¸€å¯¹çš„æƒ…å†µã€‚</p>

<p>æ‰€ä»¥å®é™…ä¸Šæˆ‘ä»¬è¦è€ƒè™‘æ‰€æœ‰$subpat$åç¼€ä¸$pat$å‰ç¼€ç›¸ç­‰çš„æƒ…å†µï¼Œå…¶å®ä¹Ÿå°±æ˜¯è®¡ç®—$pat$æ‰€æœ‰çœŸåç¼€å’ŒçœŸå‰ç¼€ç›¸ç­‰çš„æƒ…å†µï¼Œç„¶åæŒ‰ç…§é•¿åº¦ä»å¤§åˆ°å°ï¼Œ$j$åˆ†åŒºé—´è®¡ç®—</p>

<p>ä¸åŒçš„$delta_2(j)$ã€‚è€Œå¦‚ä½•å¾—åˆ°$pat$æ‰€æœ‰ç›¸ç­‰çš„çœŸå‰ç¼€å’ŒçœŸåç¼€é•¿åº¦å‘¢ï¼Ÿç­”æ¡ˆæ­£æ˜¯åˆ©ç”¨å‰ç¼€å‡½æ•°å’Œé€†å‘è¿ç”¨è®¡ç®—å‰ç¼€å‡½æ•°çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š$j^{(n)} = \pi[j^{(n-1)}-1]$ã€‚</p>

<p>ä»$\pi[patlastpos]$å¼€å§‹ä½œä¸ºæœ€é•¿ä¸€å¯¹çš„é•¿åº¦ï¼Œç„¶åé€šè¿‡é€†å‘è¿è¡ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¾—åˆ°ä¸‹ä¸€ä¸ªæ¬¡é•¿ç›¸ç­‰çœŸå‰ç¼€å’ŒçœŸåç¼€çš„é•¿åº¦ï¼Œ ç›´åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†ç¬¬äºŒç§æƒ…å†µçš„$delta_2$çš„è®¡ç®—ã€‚</p>

<h4 id="ç¬¬ä¸‰ç§æƒ…å†µ">ç¬¬ä¸‰ç§æƒ…å†µ</h4>

<p>$subpat$çš„é‡ç°ä¸åœ¨åˆ«çš„åœ°æ–¹ï¼Œæ°å¥½å°±åœ¨$pat$ä¸­ï¼ˆä¸åŒ…æ‹¬$pat$çš„å¤´éƒ¨ï¼‰ã€‚</p>

<p>ä¹Ÿå°±æ˜¯æŒ‰ç…§ä»å³åˆ°å·¦çš„é¡ºåºï¼Œåœ¨$pat[0\dots patlastpos-1]$ä¸­å¯»æ‰¾$subpat$ã€‚</p>

<p><em>å¼€å¯è„‘æ´ï¼šæ—¢ç„¶æ˜¯ä¸ªå­—ç¬¦ä¸²æœç´¢çš„é—®é¢˜ï¼Œé‚£ä¹ˆå½“ç„¶å¯ä»¥ç”¨è‘—åçš„BMç®—æ³•æœ¬èº«è§£å†³ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªBMçš„é€’å½’å®ç°çš„ç¬¬ä¸‰ç§æƒ…å†µï¼Œç»“æŸæ¡ä»¶æ˜¯ $patlen \leqslant  2$</em></p>

<p>è€Œä¸”æ ¹æ®$delta_2$çš„å®šä¹‰ï¼Œæ‰¾åˆ°çš„$subpat$çš„é‡ç°çš„ä¸‹ä¸€ä¸ªï¼ˆä¹Ÿå°±æ˜¯å·¦è¾¹ä¸€ä¸ªï¼‰å­—ç¬¦å’Œä½œä¸º$pat$åç¼€çš„$subpat$çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸èƒ½ä¸€æ ·ã€‚</p>

<p>è¿™å°±å¾ˆå¥½åœ°å¯å‘äº†æˆ‘ä»¬ï¼ˆèµ·ç å¾ˆå¥½åœ°å¯å‘äº†Knuthï¼‰ä½¿ç”¨ç±»ä¼¼äºè®¡ç®—å‰ç¼€å‡½æ•°çš„è¿‡ç¨‹è®¡ç®—ç¬¬ä¸‰ç§æƒ…å†µï¼Œåªä¸è¿‡æ˜¯å·¦å³åè¿‡æ¥çš„å‰ç¼€å‡½æ•°ï¼š</p>

<ul>
  <li>
    <p>ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘å­ä¸²çš„å·¦ç«¯ç‚¹å’Œå­ä¸²æœ€é•¿å…¬å…±å‰åç¼€çš„â€œå‰ç¼€â€ä½ç½®ï¼Œä»å³å‘å·¦ç§»åŠ¨ï¼Œåœ¨å‘ç°æŒ‡å‘çš„ä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰æ—¶ç»§ç»­ç§»åŠ¨ï¼Œæ­¤æ—¶ç›¸å½“äºâ€œå‰ç¼€â€å˜å¤§ï¼›</p>
  </li>
  <li>
    <p>å½“ä¸¤ä¸ªå­—ç¬¦ä¸ç›¸ç­‰æ—¶ï¼Œä¹‹å‰ç›¸ç­‰çš„éƒ¨åˆ†å°±æ»¡è¶³äº†$delta_2$å¯¹é‡ç°çš„è¦æ±‚ï¼Œå¹¶ä¸”å›é€€æŒ‡å‘â€œå‰ç¼€â€ä½ç½®çš„æŒ‡é’ˆç›´åˆ°æ„æˆæ–°çš„å­—ç¬¦ç›¸ç­‰æˆ–è€…å‡ºç•Œã€‚</p>
  </li>
</ul>

<p>åŒå‰ç¼€å‡½æ•°ä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ªè¾…åŠ©æ•°ç»„ï¼Œç”¨äºå›é€€ï¼Œå¯ä»¥ä½¿ç”¨ä¹‹å‰è®¡ç®—ç¬¬äºŒç§æƒ…å†µæ‰€ç”Ÿæˆçš„å‰ç¼€æ•°ç»„çš„ç©ºé—´ã€‚</p>

<h4 id="ä¸Šè¿°å®ç°">ä¸Šè¿°å®ç°</h4>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="nb">PartialEq</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">cmp</span><span class="p">::</span><span class="n">min</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">build_delta_2_table_improved_minghu6</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="o">&amp;</span><span class="p">[</span><span class="k">impl</span> <span class="nb">PartialEq</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">patlen</span> <span class="o">=</span> <span class="n">p</span><span class="nf">.len</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">lastpos</span> <span class="o">=</span> <span class="n">patlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">delta_2</span> <span class="o">=</span> <span class="nn">Vec</span><span class="p">::</span><span class="nf">with_capacity</span><span class="p">(</span><span class="n">patlen</span><span class="p">);</span>

    <span class="c1">// ç¬¬ä¸€ç§æƒ…å†µ</span>
    <span class="c1">// delta_2[j] = lastpos * 2 - j</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">patlen</span> <span class="p">{</span>
        <span class="n">delta_2</span><span class="nf">.push</span><span class="p">(</span><span class="n">lastpos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ç¬¬äºŒç§æƒ…å†µ</span>
    <span class="c1">// lastpos &lt;= delata2[j] = lastpos * 2 - j</span>
    <span class="k">let</span> <span class="n">pi</span> <span class="o">=</span> <span class="nf">compute_pi</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>  <span class="c1">// è®¡ç®—å‰ç¼€å‡½æ•°</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">i</span> <span class="o">=</span> <span class="n">lastpos</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">last_i</span> <span class="o">=</span> <span class="n">lastpos</span><span class="p">;</span> <span class="c1">// åªæ˜¯ä¸ºäº†åˆå§‹åŒ–</span>
    <span class="k">while</span> <span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">start</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">end</span><span class="p">;</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">lastpos</span> <span class="p">{</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">patlen</span> <span class="o">-</span> <span class="n">pi</span><span class="p">[</span><span class="n">last_i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">patlen</span> <span class="o">-</span> <span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="k">for</span> <span class="n">j</span> <span class="k">in</span> <span class="n">start</span><span class="o">..</span><span class="n">end</span> <span class="p">{</span>
            <span class="n">delta_2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lastpos</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">last_i</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// ç¬¬ä¸‰ç§æƒ…å†µ</span>
    <span class="c1">// delata2[j] &lt; lastpos</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">j</span> <span class="o">=</span> <span class="n">lastpos</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">t</span> <span class="o">=</span> <span class="n">patlen</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">f</span> <span class="o">=</span> <span class="n">pi</span><span class="p">;</span>
    <span class="k">loop</span> <span class="p">{</span>
        <span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
        <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">patlen</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="p">{</span>
            <span class="n">delta_2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">delta_2</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">lastpos</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">j</span><span class="p">);</span>  <span class="c1">// ä½¿ç”¨minå‡½æ•°ä¿è¯åé¢å¯èƒ½çš„å›é€€ä¸ä¼šè¦†ç›–å‰é¢çš„æ•°æ®</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">t</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">j</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œåªæ˜¯ä¸ºäº†å®Œæ•´å®šä¹‰</span>
    <span class="n">delta_2</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">delta_2</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="galilè§„åˆ™å¯¹å¤šæ¬¡åŒ¹é…æ—¶æœ€åæƒ…å†µçš„æ”¹å–„">Galilè§„åˆ™å¯¹å¤šæ¬¡åŒ¹é…æ—¶æœ€åæƒ…å†µçš„æ”¹å–„</h2>

<h3 id="å…³äºåç¼€åŒ¹é…ç®—æ³•çš„å¤šæ¬¡åŒ¹é…é—®é¢˜">å…³äºåç¼€åŒ¹é…ç®—æ³•çš„å¤šæ¬¡åŒ¹é…é—®é¢˜</h3>

<p>ä¹‹å‰çš„æœç´¢ç®—æ³•åªæ¶‰åŠåˆ°åœ¨$string$ä¸­å¯»æ‰¾ç¬¬ä¸€æ¬¡$pat$åŒ¹é…çš„æƒ…å†µï¼Œè€Œå¯¹ä¸åœ¨$string$ä¸­å¯»æ‰¾å…¨éƒ¨$pat$çš„åŒ¹é…çš„æƒ…å†µæœ‰å¾ˆå¤šä¸åŒçš„ç®—æ³•æ€è·¯ï¼Œè¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒå…³æ³¨ç‚¹æ˜¯ï¼š</p>

<p><strong>å¦‚ä½•åˆ©ç”¨ä¹‹å‰åŒ¹é…æˆåŠŸçš„å­—ç¬¦çš„ä¿¡æ¯ï¼Œå°†æœ€åæƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦é™ä¸ºçº¿æ€§ã€‚</strong></p>

<p>åœ¨åŸå§‹çš„æˆåŠŸåŒ¹é…åï¼Œç®€å•çš„$string$çš„æŒ‡é’ˆå‘åæ»‘åŠ¨$patlen$è·ç¦»åé‡æ–°å¼€å§‹åç¼€åŒ¹é…ï¼Œè¿™ä¼šå¯¼è‡´æœ€åæƒ…å†µä¸‹å›åˆ°$O(mn)$çš„æ—¶é—´å¤æ‚åº¦ï¼ˆæŒ‰ç…§æƒ¯ä¾‹ï¼Œ$m$ä¸º$patlen$ï¼Œ$n$ä¸º$stringlen$ï¼Œä¸‹åŒï¼‰ã€‚</p>

<p>æ¯”å¦‚ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼š$pat$ï¼š $\texttt{AAA}$ï¼Œ $string$ï¼š$\texttt{AAAAA}\dots$ã€‚</p>

<p>å¯¹æ­¤Knuthæå‡ºæ¥çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªâ€œæ•°é‡æœ‰é™â€çš„çŠ¶æ€çš„é›†åˆæ¥è®°å½•$patlen$é•¿åº¦çš„å­—ç¬¦ï¼Œè¿™ç§ç®—æ³•ä¿è¯$string$ä¸Šæ¯ä¸€ä¸ªå­—ç¬¦æœ€å¤šæ¯”è¾ƒä¸€æ¬¡ï¼Œä½†ä»£ä»·æ˜¯è¿™ä¸ªâ€œæ•°é‡æœ‰é™â€çš„çŠ¶æ€å¯èƒ½æ•°ç›®å¹¶ä¸æ€ä¹ˆâ€œæœ‰é™â€ï¼Œæ¯”å¦‚ç«‹åˆ»å°±èƒ½æƒ³åˆ°å®ƒçš„ä¸Šé™æ˜¯$2^{m}$ä¸ªï¼Œä½†å¹¶ä¸æ¸…æ¥šå®ƒåˆ°åº•èƒ½å˜å¾—å¤šå¤§ï¼Œå¯¹äºä¸€ä¸ªå­—ç¬¦å½¼æ­¤ä¸ç›¸ç­‰çš„$pat$ï¼Œéœ€è¦$\dfrac{1}{2}m^{2}+m$ä¸ªçŠ¶æ€ã€‚è¿™ä¸ªç®—æ³•æ€è·¯åŒåœ¨1977å¹´6æœˆçš„å‘è¡¨KMPè®ºæ–‡<sup id="fnref:1977KMP" role="doc-noteref"><a href="#fn:1977KMP" class="footnote" rel="footnote">3</a></sup>é‡Œè¢«ä»‹ç»ï¼Œä¹Ÿè®¸åœ¨æœªæ¥æŸä¸ªèŠ‚ç‚¹åŒ¹é…ä»£ä»·å¾ˆé«˜ä½†çŠ¶æ€å­˜å‚¨ä»£ä»·å¾ˆä½çš„æ–°åœºæ™¯èƒ½é‡æ–°å¾—åˆ°åº”ç”¨ï¼Œä½†å¯¹äºç°åœ¨ç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…ï¼Œè¿™ä¸ªè®¾è®¡å¹¶ä¸ç‰¹åˆ«åˆé€‚ã€‚</p>

<p>è€ŒKnuthæå‡ºçš„å¦ä¸€ä¸ªæ–¹æ³•ï¼Œå—¯è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼ŒåŒåœ¨ä¸Šé¢çš„Knuthè®ºæ–‡é‡Œè¢«ä»‹ç»ï¼Œç¼ºç‚¹æ˜¯é™¤äº†è¿‡äºå¤æ‚ä»¥å¤–ä¸»è¦æ˜¯æ„å»ºè¾…åŠ©çš„æ•°æ®ç»“æ„éœ€è¦çš„é¢„å¤„ç†æ—¶é—´å¤ªå¤§ï¼Œ$O(qm)$</p>

<p>$q$ä¸ºå…¨å­—ç¬¦é›†çš„å¤§å°ï¼Œè€Œä¸”$qm$å‰é¢çš„ç³»æ•°å¾ˆå¤§ã€‚</p>

<p>äºæ˜¯åœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹å°±æœ‰äº†ä¸‹é¢ä»‹ç»çš„æ€è·¯ç®€å•ï¼Œä¸éœ€è¦é¢å¤–é¢„å¤„ç†å¼€é”€çš„Galilç®—æ³•<sup> <a href="https://doi.org/10.1145%2F359146.359148">[4]</a> </sup>ã€‚</p>

<h3 id="galilè§„åˆ™">Galilè§„åˆ™</h3>

<p>åŸç†å¾ˆç®€å•ï¼Œå‡å®šä¸€ä¸ª$pat$ï¼Œå®ƒæ˜¯æŸä¸ªå­ä¸²$U$é‡å¤næ¬¡æ„æˆçš„å­—ç¬¦ä¸²$UUUU\dots$çš„å‰ç¼€ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°$U$ä¸º$pat$çš„ä¸€ä¸ªå‘¨æœŸã€‚</p>

<p>æ¯”å¦‚ï¼Œ$pat:$ $\texttt{ABCABCAB}$ï¼Œæ˜¯$\texttt{ABC}$çš„é‡å¤$\texttt{ABCABCABC}$çš„å‰ç¼€ï¼Œæ‰€ä»¥$\texttt{ABC}$å°±æ˜¯è¿™ä¸ª$pat$çš„å‘¨æœŸï¼Œå½“ç„¶å…¶å®$\texttt{ABCABC}\dots$ä¹Ÿæ˜¯$pat$çš„å‘¨æœŸï¼Œä½†æˆ‘ä»¬åªå…³æ³¨æœ€çŸ­çš„é‚£ä¸ªã€‚</p>

<p>äº‹å®ä¸Šï¼Œå¹¿ä¹‰åœ°è®²ï¼Œ$pat$è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªé•¿åº¦ä¸ºå®ƒè‡ªèº«çš„å‘¨æœŸã€‚</p>

<p>æˆ‘ä»¬è§„å®šè¿™ä¸ªæœ€çŸ­çš„å‘¨æœŸä¸º$k$ï¼Œ$k\leq patlen$ã€‚</p>

<p>åœ¨æœç´¢è¿‡ç¨‹ä¸­ï¼Œå‡å¦‚æˆ‘ä»¬çš„$pat$æˆåŠŸåœ°å®Œæˆäº†ä¸€æ¬¡åŒ¹é…ï¼Œé‚£ä¹ˆä¾ç…§å‘¨æœŸçš„ç‰¹ç‚¹ï¼Œå®é™…ä¸Šåªéœ€å°†$string$å‘åæ»‘åŠ¨$k$ä¸ªå­—ç¬¦ï¼Œæ¯”è¾ƒè¿™$k$ä¸ªå­—ç¬¦æ˜¯å¦å¯¹åº”ç›¸ç­‰å°±å¯ä»¥ç›´æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨$pat$çš„åˆä¸€ä¸ªåŒ¹é…ã€‚</p>

<p>è€Œå¦‚ä½•è®¡ç®—è¿™ä¸ªæœ€çŸ­å‘¨æœŸçš„é•¿åº¦å‘¢ï¼Œå‡å¦‚æˆ‘ä»¬çŸ¥é“$pat$çš„ç›¸ç­‰çš„ä¸€å¯¹å„¿å‰ç¼€-åç¼€ï¼Œè®¾å®ƒä»¬çš„é•¿åº¦ä¸º$\textit{prefixlen}$ï¼Œé‚£ä¹ˆæœ‰$pat[i] = pat[i+(patlen-\textit{prefixlen})]$ã€‚</p>

<p>è€Œä»æ•°å­¦çš„è§’åº¦çœ‹è¿™ä¸ªå…¬å¼ï¼Œæ˜¾ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†é•¿åº¦ä¸º$patlen-\textit{prefixlen}$çš„å‘¨æœŸï¼Œè€Œå½“æˆ‘ä»¬çŸ¥é“$pat$æœ€é•¿çš„é‚£ä¸€å¯¹ç›¸ç­‰çš„å‰ç¼€-åç¼€ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†$pat$æœ€çŸ­çš„å‘¨æœŸã€‚</p>

<p>è€Œè¿™ä¸ªæœ€é•¿ç›¸ç­‰çš„å‰åç¼€é•¿åº¦ï¼Œ$\pi[patlastpos]$ï¼Œåœ¨æˆ‘ä»¬åœ¨è®¡ç®—$delta_2$çš„æ—¶å€™å·²ç»è®¡ç®—è¿‡äº†ï¼Œæ‰€ä»¥å®é™…ä¸éœ€è¦é¢å¤–çš„é¢„å¤„ç†æ—¶é—´å’Œç©ºé—´ï¼Œå°±èƒ½æ”¹å–„åç¼€åŒ¹é…ç®—æ³•æœ€åæƒ…å†µçš„æ—¶é—´å¤æ‚åº¦ä¸ºçº¿æ€§ã€‚</p>

<h3 id="ç»“åˆä¸Šè¿°ä¼˜åŒ–çš„bmçš„æœç´¢ç®—æ³•æœ€ç»ˆå®ç°">ç»“åˆä¸Šè¿°ä¼˜åŒ–çš„BMçš„æœç´¢ç®—æ³•æœ€ç»ˆå®ç°</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#[cfg(target_pointer_width</span> <span class="nd">=</span> <span class="s">"64"</span><span class="nd">)]</span>
<span class="k">const</span> <span class="n">LARGE</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">10_000_000_000_000_000_000</span><span class="p">;</span>

<span class="nd">#[cfg(not(target_pointer_width</span> <span class="nd">=</span> <span class="s">"64"</span><span class="nd">))]</span>
<span class="k">const</span> <span class="n">LARGE</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">2_000_000_000</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">BMPattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">pat_bytes</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="n">delta_1</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">256</span><span class="p">],</span>
    <span class="n">delta_2</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">k</span><span class="p">:</span> <span class="nb">usize</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">BMPattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
        <span class="k">let</span> <span class="n">string_bytes</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">stringlen</span> <span class="o">=</span> <span class="n">string_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">patlen</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">pat_last_pos</span> <span class="o">=</span> <span class="n">patlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">string_index</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">pat_index</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">l0</span> <span class="o">=</span>  <span class="n">patlen</span> <span class="o">-</span> <span class="k">self</span><span class="py">.k</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">while</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">stringlen</span> <span class="p">{</span>
            <span class="k">while</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">stringlen</span> <span class="p">{</span>
                <span class="n">string_index</span> <span class="o">+=</span> <span class="k">self</span><span class="nf">.delta0</span><span class="p">(</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">LARGE</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">string_index</span> <span class="o">-=</span> <span class="n">LARGE</span><span class="p">;</span>
            <span class="n">pat_index</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>
            <span class="k">while</span> <span class="n">pat_index</span> <span class="o">&gt;</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="o">==</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="p">[</span><span class="n">pat_index</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">string_index</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">pat_index</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">pat_index</span> <span class="o">==</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="o">==</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="p">[</span><span class="n">pat_index</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="n">string_index</span> <span class="o">-</span> <span class="n">l</span><span class="p">);</span>

                <span class="n">string_index</span> <span class="o">+=</span> <span class="n">pat_last_pos</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="k">self</span><span class="py">.k</span><span class="p">;</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">string_index</span> <span class="o">+=</span> <span class="nf">max</span><span class="p">(</span>
                    <span class="k">self</span><span class="py">.delta_1</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">],</span>
                    <span class="k">self</span><span class="py">.delta_2</span><span class="p">[</span><span class="n">pat_index</span><span class="p">],</span>
                <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æœ€åæƒ…å†µåœ¨å®è·µä¸­æ€§èƒ½å½±å“">æœ€åæƒ…å†µåœ¨å®è·µä¸­æ€§èƒ½å½±å“</h3>

<p>ä»å®è·µçš„è§’åº¦ä¸Šè¯´ï¼Œç†è®ºä¸Šçš„æœ€åæƒ…å†µå¹¶ä¸å®¹æ˜“å½±å“æ€§èƒ½è¡¨ç°ï¼Œå“ªæ€•æ˜¯å¾ˆå°çš„åªæœ‰4çš„å­—ç¬¦é›†çš„éšæœºæ–‡æœ¬æµ‹è¯•ä¸‹è¿™ç§æœ€åæƒ…å†µçš„å½±å“ä¹Ÿå°åˆ°éš¾ä»¥è§‚å¯Ÿã€‚</p>

<p>ä¹Ÿå› æ­¤å¦‚æœæ²¡æœ‰å¾ˆå¥½åœ°è®¾è®¡ï¼Œä½¿ç”¨Galilæ³•åˆ™ä¼šæ‹–ç´¯ä¸€ç‚¹å¹³å‡çš„æ€§èƒ½è¡¨ç°ï¼Œä½†å¯¹äºä¸€äº›æç«¯ç‰¹æ®Šçš„$pat$å’Œ$string$æ¯”å¦‚ä¾‹å­ä¸­çš„ï¼š$pat$ï¼š $\texttt{AAA}$ï¼Œ $string$ï¼š$\texttt{AAAAA}\dots$ï¼ŒGulilè§„åˆ™çš„åº”ç”¨ç¡®å®ä¼šä½¿å¾—æ€§èƒ½è¡¨ç°æé«˜æ•°å€ã€‚</p>

<h2 id="å®è·µåŠåç»­">å®è·µåŠåç»­</h2>

<p>è¿™ä¸ªéƒ¨åˆ†è¦è®¨è®ºå®è·µä¸­çš„å…·ä½“é—®é¢˜ã€‚</p>

<p>å°½ç®¡å‰é¢ç»™å‡ºäº†ä¸€äº›ç®—æ³•çš„å®ç°ä»£ç ï¼Œä½†å¹¶æ²¡æœ‰çœŸæ­£è®¨è®ºè¿‡å®Œæ•´å®ç°å¯èƒ½é¢ä¸´çš„ä¸€äº›â€œå°é—®é¢˜â€ã€‚</p>

<h3 id="å­—ç¬¦ç±»å‹çš„è€ƒè™‘">å­—ç¬¦ç±»å‹çš„è€ƒè™‘</h3>

<p>åœ¨è‹±è¯­ç¯å¢ƒä¸‹ï¼Œç‰¹åˆ«æ˜¯ä¸Šä¸–çºª70å¹´ä»£é‚£ä¸ªæ—¶å€™ï¼Œäººä»¬è€ƒè™‘å­—ç¬¦ï¼Œé»˜è®¤çš„å‰ææ˜¯å®ƒæ˜¯ASCIIç ï¼Œé€šç”¨å­—ç¬¦è¡¨æ˜¯å®¹æ˜“é€šè¿‡ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„æ¥ç¡®å®šçš„ã€‚$delta_1$çš„åˆå§‹åŒ–åªéœ€è¦åŸºäºè¿™ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ã€‚</p>

<p>è€Œåœ¨å°è¯•ç”¨Rustå®ç°ä¸Šè¿°ç®—æ³•çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªé‡åˆ°çš„é—®é¢˜æ˜¯å­—ç¬¦çš„é—®é¢˜ï¼Œç”¨ä¸€é—¨å¾ˆæ–°çš„2010+å‘å±•èµ·æ¥çš„è¯­è¨€æ¥å®ç°1970+æ—¶ä»£çš„ç®—æ³•ï¼Œæ˜¯ä¸€ä»¶å¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼Œ</p>

<p>ä¼šè§‚å¯Ÿåˆ°ä¸€äº›å› æ—¶ä»£å‘å±•è€Œäº§ç”Ÿçš„ä¸€äº›å˜åŒ–ï¼Œç°ä»£çš„ç¼–ç¨‹è¯­è¨€ï¼Œå†…ç”Ÿçš„<code class="language-plaintext highlighter-rouge">char</code>ç±»å‹å°±æ˜¯Unicodeï¼Œé¦–å…ˆä¸å¯èƒ½ç”¨ä¸€ä¸ªå…¨å­—ç¬¦é›†å¤§å°çš„æ•°ç»„æ¥è®¡ç®—$delta_1$ï¼Œï¼ˆå…¶å®ä¹Ÿå¯ä»¥ï¼Œåªæ˜¯å®Œæˆä¸€ä¸ªUTF-8ç¼–ç çš„å­—ç¬¦ä¸²æœç´¢å¯èƒ½éœ€è¦é¢å¤–1GBå†…å­˜ï¼‰ä½†æ˜¯å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨æ¥ä»£æ›¿ï¼ŒåŒæ ·æ˜¯$O(1)$ çš„éšæœºè®¿é—®æˆæœ¬ï¼Œæ¯•ç«Ÿå“ˆå¸Œè¡¨æ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€æœ€åŸºç¡€çš„æ ‡å‡†ä»¶ä¹‹ä¸€äº†ï¼ˆå“ªæ€•æ˜¯Goéƒ½æœ‰å‘¢ï¼‰ã€‚</p>

<p>ä½†æ›´ä¸¥é‡çš„é—®é¢˜æ˜¯Unicodeä½¿ç”¨çš„éƒ½æ˜¯å˜é•¿çš„å­—èŠ‚ç¼–ç æ–¹æ¡ˆï¼Œæ‰€ä»¥æ²¡åŠæ³•ç›´æ¥æŒ‰ç…§å­—ç¬¦ä¸ªæ•°è®¡ç®—è·³è½¬çš„å­—èŠ‚æ•°ï¼Œå½“ç„¶ï¼Œå¦‚æœé™å®šæ–‡æœ¬æ˜¯ç®€å•çš„ASCIIå­—ç¬¦é›†ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æŒ‰ç…§1å­—ç¬¦å®½1å­—èŠ‚æ¥è¿›è¡Œå¿«é€Ÿè·³è½¬ï¼Œä½†è¿™æ ·çš„å®ç°æ ¹æœ¬å°±æ²¡å•¥åµç”¨ï¼ğŸ˜ </p>

<p>åœ¨æ€è€ƒçš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆçš„ä¸€ä¸ªæƒ³æ³•æ˜¯ç›´æ¥å°†å­—ç¬¦ä¸²è½¬ä¸ºæŒ‰å­—ç¬¦ç´¢å¼•çš„å‘é‡æ•°ç»„ï¼Œä½†è¿™æ„å‘³ç€å•¥éƒ½ä¸ç”¨åšå°±å…ˆæœ‰äº†ä¸€ä¸ªéå†å­—ç¬¦ä¸²çš„æ—¶é—´å¼€é”€ï¼Œå’Œé¢å¤–çš„å¤§äºç­‰äºå­—ç¬¦ä¸²å­—èŠ‚æ•°çš„é¢å¤–ç©ºé—´å¼€é”€ï¼ˆå› ä¸º<code class="language-plaintext highlighter-rouge">char</code>ç±»å‹æ˜¯Unicodeå­—é¢å€¼ï¼Œé‡‡ç”¨å›ºå®š4å­—èŠ‚å¤§å°ä¿å­˜ï¼‰ã€‚</p>

<p>äºæ˜¯æˆ‘æ”¹è¿›äº†æ€è·¯ï¼Œå¯¹äºå˜é•¿ç¼–ç å­—ç¬¦ä¸²ï¼Œè‡³å°‘è¦å®Œå…¨éå†ä¸€éï¼Œæ‰èƒ½å®Œæˆå­—ç¬¦ä¸²åŒ¹é…ï¼Œé‚£ä¹ˆåœ¨éå†è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½¿ç”¨ä¸€ä¸ªåŸºäºå¯å¢é•¿çš„ç¯ç»“æ„å®ç°çš„åŒå¤´é˜Ÿåˆ—ä½œä¸ºæ»‘åŠ¨çª—å£ï¼Œä¿å­˜è¿‡å»$patlen$ä¸ªå­—ç¬¦ï¼Œå¦‚æœå½“å‰$string$çš„ç´¢å¼•å°äºç®—æ³•è®¡ç®—çš„è·³è½¬ï¼Œå°±è®©å¾ªç¯ç©ºè½¬ç›´åˆ°ç­‰äºç®—æ³•è¦æ±‚çš„ç´¢å¼•ã€‚å®è·µè¯æ˜ï¼Œè¿™ä¸ªå·§å¦™çš„è®¾è®¡ä½¿å¾—åœ¨ä¸€èˆ¬å­—ç¬¦ä¸Šæœç´¢çš„BMç®—æ³•çš„å®ç°æ¯”æš´åŠ›åŒ¹é…ç®—æ³•è¿˜è¦æ…¢ä¸€äº›ã€‚ğŸ˜³ğŸ˜³</p>

<p>äºæ˜¯æŒ«æŠ˜ä½¿æˆ‘å›°æƒ‘ï¼Œå›°æƒ‘ä½¿æˆ‘æ€è€ƒï¼Œç»ˆäºä¸€æŸé˜³å…‰ç…§è¿›äº†çŸ³å¤´ç¼é‡Œï¼š</p>

<ol>
  <li>å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•é«˜æ•ˆçš„å…³é”®åœ¨äºå­—ç¬¦ç´¢å¼•çš„å¿«é€Ÿè·³è½¬</li>
  <li>å­—ç¬¦ç´¢å¼•ä¸€å®šè¦å»ºç«‹åœ¨ç­‰å®½å­—ç¬¦çš„åŸºç¡€ä¸Šï¼Œ</li>
</ol>

<p>åŸºäºè¿™ä¸¤æ¡åŸåˆ™æ€è€ƒï¼Œæˆ‘å°±å‘ç°äºŒè¿›åˆ¶å­—èŠ‚æœ¬èº«ï¼š1å­—èŠ‚ç­‰å®½ã€å­—ç¬¦å…¨é›†å¤§å°æ˜¯256ï¼Œå°±æ˜¯ç¬¦åˆæ¡ä»¶çš„å®Œç¾å­—ç¬¦ï¼åœ¨è¿™ä¸ªåŸºç¡€ä¸Šå®Œæˆäº†ä¸€ç³»åˆ—åç¼€åŒ¹é…ç®—æ³•çš„é«˜æ•ˆå®ç°ã€‚</p>

<h3 id="simplified-boyer-moore-ç®—æ³•">Simplified Boyer-Moore ç®—æ³•</h3>

<p>BMç®—æ³•æœ€å¤æ‚çš„åœ°æ–¹å°±åœ¨äº$delta_2$è¡¨ï¼ˆæœ‰ä¸€ä¸ªé€šä¿—çš„åå­—ï¼Œå¥½åç¼€è¡¨ï¼‰çš„æ„å»ºï¼Œè€Œåœ¨åœ¨å®è·µä¸­å‘ç°ï¼Œä¸€èˆ¬çš„å­—ç¬¦é›†ä¸Šçš„åŒ¹é…æ€§èƒ½ä¸»è¦ä¾é $delta_1$è¡¨ï¼ˆé€šä¿—çš„åå­—æ˜¯åå­—ç¬¦è¡¨ï¼‰ï¼Œäºæ˜¯å‡ºç°äº†ä»…ä»…ä½¿ç”¨$delta_1$è¡¨çš„ç®€åŒ–ç‰ˆBMç®—æ³•ï¼Œé€šå¸¸è¡¨ç°å’Œå®Œæ•´ç‰ˆå·®è·å¾ˆå°ã€‚</p>

<h3 id="boyer-moore-horspol-ç®—æ³•">Boyer-Moore-Horspol ç®—æ³•</h3>

<p>Horspolç®—æ³•åŒæ ·æ˜¯åŸºäºåå­—ç¬¦çš„è§„åˆ™ï¼Œä¸è¿‡æ˜¯åœ¨ä¸ä¸$pat$å°¾éƒ¨å¯¹é½çš„å­—ç¬¦ä¸Šåº”ç”¨$delta_1$ï¼Œè¿™ä¸ªæ•ˆæœç±»ä¼¼äºå‰æ–‡å¯¹åŒ¹é…ç®—æ³•çš„æ”¹è¿›ï¼Œæ‰€ä»¥å®ƒçš„é€šå¸¸è¡¨ç°ä¼˜äºåŸå§‹BMã€å’ŒåŒ¹é…ç®—æ³•æ”¹è¿›åçš„BMå·®ä¸å¤šã€‚</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">struct</span> <span class="n">HorspoolPattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">pat_bytes</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="n">bm_bc</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">256</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">HorspoolPattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
	<span class="c1">// ...</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
        <span class="k">let</span> <span class="n">string_bytes</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">stringlen</span> <span class="o">=</span> <span class="n">string_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">pat_last_pos</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">string_index</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>

        <span class="k">while</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">stringlen</span> <span class="p">{</span>
            <span class="k">if</span> <span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="o">..</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="k">self</span><span class="py">.pat_bytes</span> <span class="p">{</span>
                <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="n">string_index</span> <span class="o">+=</span> <span class="k">self</span><span class="py">.bm_bc</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="boyer-moore-sunday-ç®—æ³•">Boyer-Moore-Sunday ç®—æ³•</h3>

<p>Sundayç®—æ³•åŒæ ·æ˜¯åˆ©ç”¨åå­—ç¬¦è§„åˆ™ï¼Œåªä¸è¿‡ç›¸æ¯”Horspoolå®ƒæ›´è¿›ä¸€æ­¥ï¼Œç›´æ¥å…³æ³¨$pat$å°¾éƒ¨å¯¹é½çš„é‚£ä¸ªå­—ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œåªä¸è¿‡è¦ç¨å¾®ä¿®æ”¹ä¸€ä¸‹$delta_1$è¡¨ï¼Œ</p>

<p>ä½¿å¾—å®ƒç›¸å½“äºåœ¨$patlen+1$é•¿åº¦çš„$pat$ä¸Šæ„å»ºçš„ã€‚</p>

<p>Sundayç®—æ³•é€šå¸¸ç”¨ä½œä¸€èˆ¬æƒ…å†µä¸‹å®ç°æœ€ç®€å•è€Œä¸”å¹³å‡è¡¨ç°æœ€å¥½ä¹‹ä¸€çš„å®ç”¨ç®—æ³•ï¼Œé€šå¸¸è¡¨ç°æ¯”Horspoolã€BMéƒ½è¦å¿«ä¸€ç‚¹ã€‚</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">struct</span> <span class="n">SundayPattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">pat_bytes</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="n">sunday_bc</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">256</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">SundayPattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fn</span> <span class="nf">build_sunday_bc</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span> <span class="mi">256</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">sunday_bc_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="nf">.len</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="mi">256</span><span class="p">];</span>

        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">p</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">sunday_bc_table</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">sunday_bc_table</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
        <span class="k">let</span> <span class="n">string_bytes</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">pat_last_pos</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">stringlen</span> <span class="o">=</span> <span class="n">string_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">string_index</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>

        <span class="k">while</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">stringlen</span> <span class="p">{</span>
            <span class="k">if</span> <span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span> <span class="o">-</span> <span class="n">pat_last_pos</span><span class="o">..</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="k">self</span><span class="py">.pat_bytes</span> <span class="p">{</span>
                <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="n">string_index</span> <span class="o">-</span> <span class="n">pat_last_pos</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">string_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">stringlen</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">string_index</span> <span class="o">+=</span> <span class="k">self</span><span class="py">.sunday_bc</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="bmhbnfs-ç®—æ³•">BMHBNFS ç®—æ³•</h3>

<p>è¯¥ç®—æ³•ç»“åˆäº†Horspoolå’ŒSundayï¼Œæ˜¯CPythonå®ç°<code class="language-plaintext highlighter-rouge">stringlib</code>æ¨¡å—æ—¶ç”¨åˆ°çš„<code class="language-plaintext highlighter-rouge">find</code>çš„ç®—æ³•<sup id="fnref:B5S" role="doc-noteref"><a href="#fn:B5S" class="footnote" rel="footnote">4</a></sup>ï¼Œä¼¼ä¹å›½å†…æ›´æœ‰åæ°”ï¼Œä¸æ¸…æ¥šä¸ºä½•å«è¿™ä¸ªåå­—ï¼Œæ€ä¹ˆå°±â€œAKAâ€äº†ï¼Ÿ</p>

<p>ä»¥ä¸‹ç®€ç§°B5Sã€‚</p>

<p>B5SåŸºæœ¬æƒ³æ³•æ˜¯ï¼š</p>

<ol>
  <li>
    <p>æŒ‰ç…§åç¼€åŒ¹é…çš„æ€è·¯ï¼Œé¦–å…ˆæ¯”è¾ƒ$patlastpos$ä½ç½®å¯¹åº”çš„å­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰å°±æ¯”è¾ƒ$0\dots patlastpos-1$ å¯¹åº”ä½ç½®çš„å­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä»ç„¶ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±å‘ç°ä¸€ä¸ªåŒ¹é…ï¼›</p>
  </li>
  <li>
    <p>å¦‚æœä»»ä½•ä¸€ä¸ªé˜¶æ®µå‘ç”Ÿä¸åŒ¹é…ï¼Œå°±è¿›å…¥è·³è½¬é˜¶æ®µï¼›</p>
  </li>
  <li>
    <p>åœ¨è·³è½¬é˜¶æ®µï¼Œé¦–å…ˆè§‚å¯Ÿ$patlastpos$ä½ç½®çš„ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦åœ¨$pat$ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œç›´æ¥å‘å³æ»‘åŠ¨$patlen+1$ï¼Œè¿™æ˜¯Sundayç®—æ³•çš„æœ€å¤§åˆ©ç”¨</p>

    <p>å¦‚æœè¿™ä¸ªå­—ç¬¦åœ¨$pat$ä¸­ï¼Œå¯¹$patlastpos$å¤„çš„å­—ç¬¦åˆ©ç”¨$delta_1$è¿›è¡ŒHorspoolè·³è½¬ã€‚</p>
  </li>
</ol>

<p>è¿™ä¸ªé¦–å…ˆæ¯”è¾ƒæœ€åä½ç½®å­—ç¬¦è€Œä¸æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²</p>

<p>è€Œè¿™ä¸ªç®—æ³•æ ¹æ®æ—¶é—´èŠ‚çœè¿˜æ˜¯ç©ºé—´èŠ‚çœä¸ºç¬¬ä¸€ç›®æ ‡ï¼Œä¼šæœ‰å·®åˆ«å·¨å¤§çš„ä¸åŒå®ç°ã€‚</p>

<h4 id="æ—¶é—´èŠ‚çœç‰ˆæœ¬">æ—¶é—´èŠ‚çœç‰ˆæœ¬</h4>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">struct</span> <span class="n">B5STimePattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">pat_bytes</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="n">alphabet</span><span class="p">:</span> <span class="p">[</span><span class="nb">bool</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span>
    <span class="n">bm_bc</span><span class="p">:</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span>
    <span class="n">k</span><span class="p">:</span> <span class="nb">usize</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">B5STimePattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">pat</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="nd">assert_ne!</span><span class="p">(</span><span class="n">pat</span><span class="nf">.len</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">pat_bytes</span> <span class="o">=</span> <span class="n">pat</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">bm_bc</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nn">B5STimePattern</span><span class="p">::</span><span class="nf">build</span><span class="p">(</span><span class="n">pat_bytes</span><span class="p">);</span>

        <span class="n">B5STimePattern</span> <span class="p">{</span> <span class="n">pat_bytes</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">,</span> <span class="n">bm_bc</span><span class="p">,</span> <span class="n">k</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">build</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="p">([</span><span class="nb">bool</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span> <span class="p">[</span><span class="nb">usize</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span> <span class="nb">usize</span><span class="p">)</span>  <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">alphabet</span> <span class="o">=</span> <span class="p">[</span><span class="k">false</span><span class="p">;</span><span class="mi">256</span><span class="p">];</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">bm_bc</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="nf">.len</span><span class="p">();</span> <span class="mi">256</span><span class="p">];</span>
        <span class="k">let</span> <span class="n">lastpos</span> <span class="o">=</span> <span class="n">p</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">lastpos</span> <span class="p">{</span>
            <span class="n">alphabet</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="n">bm_bc</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">=</span> <span class="n">lastpos</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">alphabet</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">bm_bc</span><span class="p">,</span> <span class="nf">compute_k</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
        <span class="k">let</span> <span class="n">string_bytes</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">pat_last_pos</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">patlen</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">stringlen</span> <span class="o">=</span> <span class="n">string_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">string_index</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">offset0</span> <span class="o">=</span> <span class="k">self</span><span class="py">.k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">while</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">stringlen</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="o">==</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="p">[</span><span class="n">pat_last_pos</span><span class="p">]</span> <span class="p">{</span>
                <span class="k">if</span> <span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">-</span><span class="n">offset</span><span class="o">..</span><span class="n">string_index</span><span class="p">]</span> <span class="o">==</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.pat_bytes</span><span class="p">[</span><span class="n">pat_last_pos</span><span class="o">-</span><span class="n">offset</span><span class="o">..</span><span class="n">pat_last_pos</span><span class="p">]</span> <span class="p">{</span>
                    <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="p">);</span>

                    <span class="n">offset</span> <span class="o">=</span> <span class="n">offset0</span><span class="p">;</span>

                    <span class="c1">// Galil rule</span>
                    <span class="n">string_index</span> <span class="o">+=</span> <span class="k">self</span><span class="py">.k</span><span class="p">;</span>
                    <span class="k">continue</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">string_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">stringlen</span> <span class="p">{</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">offset</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>

            <span class="k">if</span> <span class="o">!</span><span class="k">self</span><span class="py">.alphabet</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">string_index</span> <span class="o">+=</span> <span class="n">patlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// sunday</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">string_index</span> <span class="o">+=</span> <span class="k">self</span><span class="py">.bm_bc</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="k">as</span> <span class="nb">usize</span><span class="p">];</span>  <span class="c1">// horspool</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸ªç‰ˆæœ¬çš„B5Sæ€§èƒ½è¡¨ç°éå¸¸ç†æƒ³ï¼Œæ˜¯é€šå¸¸æƒ…å†µä¸‹ï¼Œç›®å‰ä»‹ç»çš„åç¼€åŒ¹é…ç³»åˆ—ç®—æ³•ä¸­æœ€å¿«çš„ã€‚</p>

<h4 id="ç©ºé—´èŠ‚çœç‰ˆæœ¬">ç©ºé—´èŠ‚çœç‰ˆæœ¬</h4>

<p>è¿™ä¹Ÿæ˜¯CPython <code class="language-plaintext highlighter-rouge">stringlib</code>ä¸­å®ç°çš„ç‰ˆæœ¬ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªæ•´æ•°è¿‘ä¼¼å–ä»£äº†å­—ç¬¦è¡¨å’Œ$delta_1$çš„ä½œç”¨ï¼Œæå¤§åœ°èŠ‚çœäº†ç©ºé—´ï¼š</p>

<h5 id="ç”¨ä¸€ä¸ªç®€å•çš„bloomè¿‡æ»¤å™¨å–ä»£å­—ç¬¦è¡¨alphabet">ç”¨ä¸€ä¸ªç®€å•çš„Bloomè¿‡æ»¤å™¨å–ä»£å­—ç¬¦è¡¨ï¼ˆalphabetï¼‰</h5>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">struct</span> <span class="n">BytesBloomFilter</span> <span class="p">{</span>
    <span class="n">mask</span><span class="p">:</span> <span class="nb">u64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">BytesBloomFilter</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">SimpleBloomFilter</span> <span class="p">{</span>
            <span class="n">mask</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">byte</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">u8</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="k">self</span><span class="py">.mask</span><span class="p">)</span> <span class="p">|</span><span class="o">=</span> <span class="mi">1u64</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">byte</span> <span class="o">&amp;</span> <span class="mi">63</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="nb">char</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">u8</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">bool</span> <span class="p">{</span>
        <span class="p">(</span><span class="k">self</span><span class="py">.mask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1u64</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">byte</span> <span class="o">&amp;</span> <span class="mi">63</span><span class="p">)))</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Bloomè¿‡æ»¤å™¨è®¾è®¾è®¡é€šè¿‡ç‰ºç‰²å‡†ç¡®ç‡ï¼ˆå®é™…è¿˜æœ‰è¿è¡Œæ—¶é—´ï¼‰æ¥æå¤§åœ°èŠ‚çœå­˜å‚¨ç©ºé—´çš„<code class="language-plaintext highlighter-rouge">Set</code>ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ä¼šå°†é›†åˆä¸­ä¸å­˜åœ¨çš„é¡¹è¯¯åˆ¤ä¸ºå­˜åœ¨ï¼ˆFalse Positivesï¼Œç®€ç§°FPï¼‰ï¼Œä½†ä¸ä¼šæŠŠé›†åˆä¸­å­˜åœ¨çš„é¡¹åˆ¤æ–­ä¸ºä¸å­˜åœ¨ï¼ˆFalse Negativesï¼Œç®€ç§°FNï¼‰ï¼Œå› æ­¤ä½¿ç”¨å®ƒå¯èƒ½ä¼šå› ä¸ºFPè€Œæ²¡æœ‰å¾—åˆ°æœ€å¤§çš„å­—ç¬¦è·³è½¬ï¼Œä½†ä¸ä¼šå› ä¸º</p>

<p>FNè€Œè·³è¿‡æœ¬åº”åŒ¹é…çš„å­—ç¬¦ã€‚</p>

<p>ç†è®ºä¸Šåˆ†æï¼Œä¸Šè¿°â€œBloomè¿‡æ»¤å™¨â€çš„å®ç°åœ¨$pat$é•¿åº¦åœ¨50ä¸ªBytesæ—¶ï¼ŒFP æ¦‚ç‡çº¦ä¸º 0.5ï¼Œè€Œ$pat$é•¿åº¦åœ¨10ä¸ªBytesæ—¶ï¼ŒFPæ¦‚ç‡çº¦ä¸º0.15ã€‚</p>

<p>å½“ç„¶è¿™ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Bloomè¿‡æ»¤å™¨ï¼Œé¦–å…ˆå®ƒå®é™…ä¸Šæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªçœŸæ­£çš„å“ˆå¸Œå‡½æ•°ï¼Œå®é™…ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªå­—ç¬¦æ˜ å°„ï¼Œå°±æ˜¯å°†0-255çš„å­—èŠ‚æ˜ å°„ä¸ºå®ƒçš„å‰å…­ä½æ„æˆçš„æ•°ï¼Œè€ƒè™‘åˆ°æˆ‘ä»¬åœ¨åšå†…å­˜ä¸Šçš„å­—ç¬¦æœç´¢ï¼Œè¿™æ ·çš„ç®€åŒ–å°±éå¸¸é‡è¦ï¼Œå› ä¸ºå³ä½¿ç”¨ç›®å‰å·²çŸ¥æœ€å¿«çš„éåŠ å¯†å“ˆå¸Œç®—æ³•xxHash<sup id="fnref:xxHash" role="doc-noteref"><a href="#fn:xxHash" class="footnote" rel="footnote">5</a></sup>ï¼Œè®¡ç®—æ‰€éœ€è¦çš„æ—¶é—´éƒ½è¦æ¯”å®ƒé«˜ä¸€ä¸ªæ•°é‡çº§ã€‚</p>

<p>å¦å¤–ï¼ŒæŒ‰ç…§è®¡ç®—ï¼Œå½“patåœ¨30å­—èŠ‚ä»¥ä¸‹æ—¶ï¼Œä¸ºäº†è¾¾åˆ°æœ€ä½³çš„FPæ¦‚ç‡ï¼Œéœ€è¦è¶…è¿‡ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œä½†è¿™ä¹ˆåšæ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºç”¨è£…æœ‰ä¸¤ä¸ª<code class="language-plaintext highlighter-rouge">u128</code>æ•°å­—çš„æ•°ç»„å°±å·²ç»å¯ä»¥æ„å»ºå­—ç¬¦è¡¨çš„å…¨å­—ç¬¦é›†ã€‚</p>

<h5 id="ä½¿ç”¨delta_1patpatlastpos-ä»£æ›¿æ•´ä¸ªdelta_1">ä½¿ç”¨$delta_1(pat[patlastpos])$ ä»£æ›¿æ•´ä¸ª$delta_1$</h5>

<p>è§‚å¯Ÿ$delta_1$æœ€å¸¸ä½¿ç”¨çš„åœ°æ–¹å°±æ˜¯åç¼€åŒ¹é…æ—¶ç¬¬ä¸€ä¸ªå­—ç¬¦å°±ä¸åŒ¹é…æ˜¯æœ€å¸¸è§çš„ä¸åŒ¹é…çš„æƒ…å†µï¼Œäºæ˜¯ä»¤<code class="language-plaintext highlighter-rouge">skip = delta1(pat[patlastpos])</code>ï¼Œ</p>

<p>åœ¨ç¬¬ä¸€é˜¶æ®µä¸åŒ¹é…æ—¶ï¼Œç›´æ¥å‘ä¸‹æ»‘åŠ¨<code class="language-plaintext highlighter-rouge">skip</code>ä¸ªå­—ç¬¦ï¼›ä½†å½“ç¬¬äºŒé˜¶æ®µä¸é…æ—¶ï¼Œå› ä¸ºç¼ºä¹æ•´ä¸ª$delta_1$çš„ä¿¡æ¯ï¼Œåªèƒ½å‘ä¸‹æ»‘åŠ¨ä¸€ä¸ªå­—ç¬¦ã€‚</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">struct</span> <span class="n">B5SSpacePattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">pat_bytes</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">],</span>
    <span class="n">alphabet</span><span class="p">:</span> <span class="n">BytesBloomFilter</span><span class="p">,</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="n">B5SSpacePattern</span><span class="o">&lt;</span><span class="nv">'a</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">pat</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="nd">assert_ne!</span><span class="p">(</span><span class="n">pat</span><span class="nf">.len</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>

        <span class="k">let</span> <span class="n">pat_bytes</span> <span class="o">=</span> <span class="n">pat</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">skip</span><span class="p">)</span> <span class="o">=</span> <span class="nn">B5SSpacePattern</span><span class="p">::</span><span class="nf">build</span><span class="p">(</span><span class="n">pat_bytes</span><span class="p">);</span>

        <span class="n">B5SSpacePattern</span> <span class="p">{</span> <span class="n">pat_bytes</span><span class="p">,</span> <span class="n">alphabet</span><span class="p">,</span> <span class="n">skip</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">build</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="p">[</span><span class="nb">u8</span><span class="p">])</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="n">BytesBloomFilter</span><span class="p">,</span> <span class="nb">usize</span><span class="p">)</span>  <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">alphabet</span> <span class="o">=</span> <span class="nn">BytesBloomFilter</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">lastpos</span> <span class="o">=</span> <span class="n">p</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">skip</span> <span class="o">=</span> <span class="n">p</span><span class="nf">.len</span><span class="p">();</span>

        <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">p</span><span class="nf">.len</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
            <span class="n">alphabet</span><span class="nf">.insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

            <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">p</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">skip</span> <span class="o">=</span> <span class="n">lastpos</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">alphabet</span><span class="nf">.insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]);</span>

        <span class="p">(</span><span class="n">alphabet</span><span class="p">,</span> <span class="n">skip</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">string</span><span class="p">:</span> <span class="o">&amp;</span><span class="nv">'a</span> <span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">usize</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">result</span> <span class="o">=</span> <span class="nd">vec!</span><span class="p">[];</span>
        <span class="k">let</span> <span class="n">string_bytes</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.as_bytes</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">pat_last_pos</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">patlen</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="n">stringlen</span> <span class="o">=</span> <span class="n">string_bytes</span><span class="nf">.len</span><span class="p">();</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">string_index</span> <span class="o">=</span> <span class="n">pat_last_pos</span><span class="p">;</span>

        <span class="k">while</span> <span class="n">string_index</span> <span class="o">&lt;</span> <span class="n">stringlen</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span> <span class="o">==</span> <span class="k">self</span><span class="py">.pat_bytes</span><span class="p">[</span><span class="n">pat_last_pos</span><span class="p">]</span> <span class="p">{</span>
                <span class="k">if</span> <span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="o">..</span><span class="n">string_index</span><span class="p">]</span> <span class="o">==</span> <span class="o">&amp;</span><span class="k">self</span><span class="py">.pat_bytes</span><span class="p">[</span><span class="o">..</span><span class="n">patlen</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">{</span>
                    <span class="n">result</span><span class="nf">.push</span><span class="p">(</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="n">string_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">stringlen</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="o">!</span><span class="k">self</span><span class="py">.alphabet</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">string_index</span> <span class="o">+=</span> <span class="n">patlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// sunday</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">string_index</span> <span class="o">+=</span> <span class="k">self</span><span class="py">.skip</span><span class="p">;</span>  <span class="c1">// horspool</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="n">string_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">stringlen</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="o">!</span><span class="k">self</span><span class="py">.alphabet</span><span class="nf">.contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">string_index</span> <span class="o">+=</span> <span class="n">patlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// sunday</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">string_index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">}</span>

        <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™ä¸ªç‰ˆæœ¬çš„ç®—æ³•ç›¸å¯¹äºå‰é¢çš„åç¼€åŒ¹é…ç®—æ³•ä¸å¤Ÿå¿«ï¼Œä½†å·®è·å¹¶ä¸å¤§ï¼Œä»ç„¶æ¯”KMPè¿™ç§å¿«å¾—å¤šï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°å®ƒæä¸ºä¼˜ç§€çš„ç©ºé—´å¤æ‚åº¦ï¼šè‡³å¤šä¸¤ä¸ª<code class="language-plaintext highlighter-rouge">u64</code>çš„æ•´æ•°ï¼Œè¿™ç¡®å®æ˜¯æä¸ºå®ç”¨çš„é€‚åˆä½œä¸ºæ ‡å‡†åº“å®ç°çš„ä¸€ç§ç®—æ³•ï¼</p>

<h2 id="ç†è®ºåˆ†æ">ç†è®ºåˆ†æ</h2>

<p>ç°åœ¨æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æ¦‚ç‡æ¨¡å‹æ¥åšä¸€äº›ç»ä¸æ¯ç‡¥çš„ç†è®ºä¸Šçš„åˆ†æï¼Œå€Ÿæ­¤å¯ä»¥å‘ç°ä¸€äº›æœ‰è¶£è€Œæ›´æ·±å…¥çš„äº‹å®ã€‚</p>

<h3 id="å»ºç«‹æ¨¡å‹">å»ºç«‹æ¨¡å‹</h3>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ»‘åŠ¨å­—ç¬¦ä¸²$pat$åˆ°æŸä¸ªæ–°çš„ä½ç½®ï¼Œè¿™ä¸ªä½ç½®è¿˜æ²¡æœ‰å®ŒæˆåŒ¹é…ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‘ç°å¤±é…æ‰€éœ€è¦çš„ä»£ä»·ä¸å‘ç°å¤±é…å$pat$èƒ½å¤Ÿå‘ä¸‹æ»‘åŠ¨çš„å­—ç¬¦æ•°çš„æ¯”å€¼æ¥è¡¡é‡ç®—æ³•çš„å¹³å‡æ€§èƒ½è¡¨ç°ã€‚</p>

<p>å‡å¦‚è¿™ä¸ªä»£ä»·æ˜¯ç”¨å¯¹$string$çš„å¼•ç”¨æ¥è¡¡é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“å¹³å‡æ¯ä¸ªå­—ç¬¦éœ€è¦å¤šå°‘æ¬¡$string$çš„å¼•ç”¨ï¼Œè¿™æ˜¯åœ¨ç†è®ºä¸Šè¡¡é‡ç®—æ³•è¡¨ç°çš„å…³é”®æŒ‡æ ‡ï¼›</p>

<p>è€Œå¦‚æœè¿™ä¸ªä»£ä»·æ˜¯ç”¨æœºå™¨æŒ‡ä»¤è¡¡é‡ï¼Œé‚£æˆ‘ä»¬å¯ä»¥çŸ¥é“å¹³å‡æ¯ä¸ªå­—ç¬¦éœ€è¦å¤šå°‘æ¡æœºå™¨æŒ‡ä»¤ï¼›</p>

<p>å½“ç„¶ä¹Ÿå¯ä»¥æœ‰å…¶ä»–çš„è¡¡é‡æ–¹å¼ï¼Œè¿™å¹¶ä¸å½±å“ä»€ä¹ˆï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å¯¹$string$çš„å¼•ç”¨è¿›è¡Œç†è®ºåˆ†æã€‚</p>

<p>åŒæ—¶ä¸ºæˆ‘ä»¬çš„æ¦‚ç‡æ¨¡å‹æå‡ºä¸€ä¸ªå‡è®¾ï¼š$pat$ï¼Œ$string$ä¸­çš„æ¯ä¸ªå­—ç¬¦æ˜¯ç‹¬ç«‹éšæœºå˜é‡ï¼Œå®ƒä»¬å‡ºç°çš„æ¦‚ç‡ç›¸ç­‰ï¼Œä¸º$p$ï¼Œ$p$å–å†³äºå…¨å­—æ¯è¡¨çš„å¤§å°ã€‚</p>

<p>æ˜¾ç„¶ï¼Œå‡å¦‚å…¨å­—æ¯è¡¨çš„å¤§å°ä¸º$q$ï¼Œåˆ™$p=\dfrac{1}{q}$ï¼Œä¾‹å¦‚å‡è®¾æˆ‘ä»¬ä¹‹å‰åŸºäºå­—èŠ‚çš„å®ç°ï¼Œåœ¨æ—¥å¸¸ä¸€èˆ¬æœç´¢æ—¶ï¼Œå¯ä»¥è¿‘ä¼¼ä¸º$q=\dfrac{1}{256}$ã€‚</p>

<p>ç°åœ¨å¯ä»¥æ›´å‡†ç¡®åœ°åˆ»ç”»è¿™ä¸ªæ¯”ç‡ï¼Œ$rate(patlen, p)$ï¼š</p>

\[\frac{\sum_{m=0}^{patlen-1} cost(m) \times prob(m)}{\sum_{m=0}^{patlen-1}prob(m) \times \sum_{k=1}^{patlen}skip(m,k) \times k }\]

<p>å…¶ä¸­ï¼Œ$cost(m)$ä¸ºå‰é¢è®¨è®ºåˆ°çš„åœ¨åŒ¹é…æˆåŠŸäº†$m$ä¸ªå­—ç¬¦åå¤±é…æ—¶çš„ä»£ä»·ï¼š</p>

\[cost(m) = m+1\]

<p>$prob(m)$ä¸ºåŒ¹é…æˆåŠŸ$m$ä¸ªå­—ç¬¦åå¤±é…çš„æ¦‚ç‡ï¼ˆå…¶ä¸­$1-p^{patlen}$æ’é™¤æ‰$pat$å…¨éƒ¨åŒ¹é…çš„æƒ…å†µï¼‰:</p>

\[prob(m) = \frac{p^m(1-p)}{1-p^{patlen}}\]

<p>$skip(m,k)$ä¸ºå‘ç”Ÿå¤±é…æ—¶$pat$å‘ä¸‹æ»‘åŠ¨$k$ä¸ªå­—ç¬¦çš„æ¦‚ç‡ï¼Œï¼ˆè¿™é‡Œçš„$k$å¦‚åŒå‰æ–‡è®¨è®ºçš„$k$ä¸€æ ·ï¼Œä¸º$pat$å®é™…æ»‘åŠ¨è·ç¦»ï¼Œä¸åŒ…æ‹¬æŒ‡é’ˆä»å¤±é…ä½ç½®å›é€€åˆ°$patlastpos$ä½ç½®çš„è·ç¦»ï¼‰ã€‚å®é™…ä¸Šæ‰€æœ‰å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•çš„æ ¸å°±åœ¨äº$skip(m,k)$ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šé€šè¿‡åˆ†æ$delta_1$å’Œ$delta_2$æ¥è®¡ç®—BoyerMooreç®—æ³•çš„$skip(m,k)$ã€‚</p>

<h3 id="è®¡ç®—boyermooreç®—æ³•çš„skipmk">è®¡ç®—BoyerMooreç®—æ³•çš„$skip(m,k)$</h3>

<h4 id="delta_1">$delta_1$</h4>

<p>é¦–å…ˆè€ƒè™‘$delta_1$ä¸èµ·ä½œç”¨çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å‘ç°å¤±é…å­—ç¬¦åœ¨$pat$ä¸Šé‡ç°çš„ä½ç½®åœ¨å·²ç»åŒ¹é…å®Œçš„$m$ä¸ªå­—ç¬¦ä¸­ï¼Œè¿™ç§æƒ…å†µçš„æ¦‚ç‡$\textit{probdelta_1_worthless}$ä¸ºï¼š</p>

\[\textit{probdelta1_worthless}(m) = 1 - (1-p)^m\]

<p>è€Œå¯¹äº$delta_1$èµ·ä½œç”¨çš„æƒ…å†µï¼Œå¯ä»¥æ ¹æ®kçš„èŒƒå›´åˆ†ä¸ºå››ç§æƒ…å†µè¿›è¡Œè®¨è®ºï¼š</p>

<ol>
  <li>
    <p>$k = 1$ï¼š</p>

    <p>1.1 å¤±é…å­—ç¬¦å¯¹åº”ä½ç½®çš„ä¸‹ä¸€ä¸ªå­—ç¬¦æ°å¥½ç­‰äºå¤±é…å­—ç¬¦ï¼›</p>

    <p>1.2 å¤±é…å­—ç¬¦å·²ç»æ˜¯$pat$å³æ‰‹èµ·æœ€åä¸€ä¸ªå­—ç¬¦ã€‚</p>
  </li>
  <li>
    <p>$1 &lt; k &lt; patlen-m$ï¼Œ$pat$åœ¨å¤±é…å­—ç¬¦å¯¹åº”ä½ç½®çš„å·¦è¾¹è¿˜æœ‰ä¸å¤±é…å­—ç¬¦ç›¸ç­‰çš„å­—ç¬¦ï¼Œå¹¶ä¸”ä¸æ»¡è¶³æƒ…å†µ1ï¼›</p>
  </li>
  <li>
    <p>$k = patlen - m$ï¼Œ$pat$åœ¨å¤±é…å­—ç¬¦å¯¹åº”ä½ç½®å·¦è¾¹æ‰¾ä¸åˆ°å¦ä¸€ä¸ªä¸å¤±é…å­—ç¬¦ç›¸ç­‰çš„å­—ç¬¦ï¼Œå¹¶ä¸”ä¸æ»¡è¶³æƒ…å†µ1ï¼Œè¿™æ—¶$pat$æœ‰æœ€å¤§å¯èƒ½çš„å‘ä¸‹æ»‘åŠ¨è·ç¦»ï¼›</p>
  </li>
  <li>
    <p>$k &gt; patlen - m$ï¼Œæ˜¾ç„¶å¯¹äº$delta_1$ï¼Œè¿™æ˜¯ä¸å¯èƒ½å­˜åœ¨çš„æƒ…å†µã€‚</p>
  </li>
</ol>

<p>äºæ˜¯æœ‰è®¡ç®—$delta_1$çš„æ¦‚ç‡å‡½æ•°ï¼š</p>

\[probdelta1(m,k) =
\left\{ \begin{array}{lcl}
(1-p)^m\times \left\{ \begin{array}{lcl} 1  &amp; \text{for} &amp;m+1=patlen \\ p &amp;\text{for}&amp;m+1\neq patlen  \\\end{array}\right. &amp; \text{for} &amp; k = 1 \\
(1-p)^{m+k-1}\times p &amp; \text{for} &amp; 1 &lt; k &lt; patlen - m\\
(1-p)^{patlen-1} &amp; \text{for} &amp; k = patlen - m\\
0 &amp; \text{for} &amp; patlen patlen - m &lt; k \leqslant patlen
\end{array}\right.\]

<h4 id="delta_2">$delta_2$</h4>

<p>å¯¹äº$delta_2$æ¦‚ç‡çš„è®¡ç®—ï¼Œæ ¹æ®å®šä¹‰ï¼Œé¦–å…ˆè®¡ç®—æŸä¸ª$subpat$çš„é‡ç°çš„æ¦‚ç‡ï¼Œåªè¦è€ƒè™‘è¯¥é‡ç°å·¦è¾¹è¿˜æœ‰æ²¡æœ‰å­—ç¬¦æ¥æä¾›é¢å¤–çš„åˆ¤æ–­ä¸å¤±é…å­—ç¬¦æ˜¯å¦ç›¸ç­‰çš„æ£€æŸ¥ï¼š</p>

\[probpr(m,k) =
\left\{ \begin{array}{lcl}
(1-p)\times p^m &amp; \text{for} &amp; 1 \leqslant k &lt; patlen - m\\
p^{patlen-k} &amp; \text{for} &amp; patlen - m \leqslant k \leqslant patlen
\end{array}\right.\]

<p>äºæ˜¯$delta_2(m,k)$ å°±å¯ä»¥é€šè¿‡ä¿è¯$pr(m,k)$å­˜åœ¨å¹¶ä¸”$k$æ›´å°çš„$delta_2$ä¸å­˜åœ¨ï¼Œæ¥é€’å½’è®¡ç®—ï¼š</p>

\[probdelta2(m,k) = probpr(m,k)(1-\sum_{n=1}^{k-1}probdelta2(m, n))\]

<h4 id="æ±‡æ€»">æ±‡æ€»</h4>

<p>å‰é¢å·²ç»ç‹¬ç«‹è®¨è®ºäº†$delta_1$ï¼Œ$delta_2$çš„æ¦‚ç‡å‡½æ•°ï¼Œä¸è¿‡è¿˜éœ€è¦é¢å¤–è€ƒè™‘ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¦‚ç‡å‡½æ•°ä¹‹é—´ç›¸äº’å½±å“çš„æƒ…å†µï¼Œè™½ç„¶åªæ˜¯ä¸€ä¸ªå¾ˆå°‘æ•°çš„æƒ…å†µï¼š</p>

<p>å½“$delta_2$è®¡ç®—çš„$k$ä¸º1çš„æ—¶å€™ï¼Œæ ¹æ®$delta_2$å®šä¹‰æˆ‘ä»¬å°±çŸ¥é“$pat[-(m+1)] = pat[-m]=pat[-(m-1)]\dots pat[-1]$ï¼Œï¼ˆ$pat[-n]$ è¡¨ç¤º$pat$çš„å€’æ•°ç¬¬$n$ä¸ªå­—ç¬¦ï¼Œä¸‹åŒï¼‰ã€‚è€Œè¿™ç§æƒ…å†µå·²ç»æ’é™¤äº†$delta_1$ä¸èµ·ä½œç”¨çš„æƒ…å†µï¼Œå› ä¸ºå½“å¦‚å‰æ–‡è®¨è®ºçš„ï¼Œ$delta_1$ä¸èµ·ä½œç”¨è¦æ±‚ä¸å¤±é…å­—ç¬¦$pat[-(m+1)]$ç›¸ç­‰çš„å­—ç¬¦å‡ºç°åœ¨$pat[-m]\dots pat[-1]$ä¸­ï¼Œ è¿™å°±äº§ç”Ÿäº†ä¸å¯èƒ½åœ¨å€’æ•°$m+1$ä¸ªå­—ç¬¦ä¸Šå¤±é…çš„çŸ›ç›¾ã€‚</p>

<p>å› æ­¤é’ˆå¯¹$delta_1$ä¸èµ·ä½œç”¨çš„æƒ…å†µéœ€è¦ä¸€ä¸ªç¨å¾®ä¿®æ”¹è¿‡çš„$delta_2$æ¦‚ç‡å‡½æ•° ï¼š</p>

\[probdelta2'(m,k) =
\left\{ \begin{array}{lcl}
0 &amp; \text{for} &amp; k = 1\\
probpr(m,k)(1-\sum_{n=2}^{k-1}probdelta2'(m, n)) &amp; \text{for} &amp; 1 \leqslant k \leqslant patlen
\end{array}\right.\]

<p>äºæ˜¯é€šè¿‡ç»„åˆ$delta_1$å’Œ$delta_2$èµ·ä½œç”¨çš„æƒ…å†µï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†BoyerMooreç®—æ³•çš„$skip$æ¦‚ç‡å‡½æ•°ï¼š</p>

\[skip(m,k) = \left\{\begin{array}{lcl}
probdelta1(m, 1) \times probdelta2(m, 1) &amp; \text{for} &amp; k = 1\\
\\
\\
\\
\textit{prodelta1_worthless}(m)\times probdelta2'(m, 1)\\
+\ probdelta1(m, k)\times \sum_{n=1}^{k-1}probdelta2(m, n)\\
+\ probdelta2(m, k)\times \sum_{n=1}^{k-1}probdelta1(m,n)\\
+\ probdelta1(m, k)\times probdelta2(m, k)
&amp; \text{for} &amp; 1 &lt; k \leqslant patlen
\end{array}\right.\]

<h3 id="åˆ†ææ¯”è¾ƒ">åˆ†ææ¯”è¾ƒ</h3>

<p>ä¸ºäº†ç»“æ„æ¸…æ™°ã€ä¹¦å†™ç®€å•ã€æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨Pythonå¹³å°çš„Lispæ–¹è¨€Hyæ¥è¿›è¡Œå®é™…è®¡ç®—ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">myprob.hy</code></p>

<pre><code class="language-Hy">(require [hy.contrib.sequences [defseq seq]])

(import [hy.contrib.sequences [Sequence end-sequence]])
(import [hy.models [HySymbol]])


(defmacro simplify-probfn [patlen p probfn-list]
    "(prob-xxx patlen p m k) -&gt; (prob-xxx-s m k)"
    (lfor probfn probfn-list
        [(setv simplified-probfn-symbol (HySymbol (.format "{}-s" (name probfn))))
        `(defn ~simplified-probfn-symbol [&amp;rest args] (~probfn patlen p #*args))]))

(defn map-sum [range-args func]
    (setv [start end] range-args)
    (-&gt; func (map (range start (inc end))) sum))

(defn cost [m] (+ m 1))

(defn prob-m [patlen p m]
    (/
        (* (** p m) (- 1 p))
        (- 1 (** p patlen))))

(defn prob-delta_1 [patlen p m k]
    (cond [(= 1 k) (* (** (- 1 p) m)
                      (if (= (inc m) patlen) 1 p))]
          [(&lt; k (- patlen m)) (* p (** (- 1 p) (dec (+ k m))))]
          [(= k (- patlen m)) (** (- 1 p) (dec patlen))]
          [(&gt; k (- patlen m)) 0]))


(defn prob-delta_1-worthless [p m] (- 1 (** (- 1 p) m)))


(defn prob-pr [patlen p m k] (if (&lt; patlen (+ m k))
                                (* (- 1 p) (** p m))
                                (** p (- patlen k))))


(defn prob-delta_2 [patlen p m]
    "prob-delta_2(_, k) = prob-delta_2-seq[k]"
    (defseq prob-delta_2-seq [n]
        (cond [(&lt; n 1) 0]
              [(= n 1) (prob-pr patlen p m 1)]
              [(&gt; n 1) (* (prob-pr patlen p m n) (- 1 (sum (take n prob-delta_2-seq))))]))
    prob-delta_2-seq)


(defn prob-delta_2-1 [patlen p m]
    (defseq prob-delta_2-1-seq [n]
        (cond [(&lt; n 2) 0]
              [(&gt;= n 2) (* (prob-pr patlen p m n) (- 1 (sum (take n prob-delta_2-1-seq))))]))
    prob-delta_2-1-seq)


(defn skip [patlen p m k prob-delta_2-seq prob-delta_2-1-seq]
    (simplify-probfn patlen p [prob-delta_1])
    (if (= k 1) (* (prob-delta_1-s m 1) (get prob-delta_2-seq 1))
        (sum [(* (prob-delta_1-worthless p m) (get prob-delta_2-1-seq k))
              (* (prob-delta_1-s m k) (sum (take k prob-delta_2-seq)))
              (* (get prob-delta_2-seq k) (map-sum [1 (- k 1)]
                                                  (fn [n] (prob-delta_1-s m n))))
              (* (prob-delta_1-s m k) (get prob-delta_2-seq k))])))


(defn bm-rate [patlen p]
    (simplify-probfn patlen p [prob-m prob-delta_2 prob-delta_2-1 skip])
    (/
        (map-sum [0 (dec patlen)]
            (fn [m] (* (cost m) (prob-m-s m))))

        (map-sum [0 (dec patlen)]
            (fn [m]
                (setv prob-delta_2-seq (prob-delta_2-s m)
                      prob-delta_2-1-seq (prob-delta_2-1-s m))
                (* (prob-m-s m) (map-sum [1 patlen]
                                    (fn [k] (* k (skip-s m k prob-delta_2-seq prob-delta_2-1-seq)))))))))
</code></pre>

<p>å¹¶ä¸”ä¸ºäº†è¿›è¡Œæ¯”è¾ƒï¼Œè¿˜é¢å¤–è®¡ç®—äº†ç®€åŒ–BMç®—æ³•:</p>

<p><code class="language-plaintext highlighter-rouge">myprob.hy</code></p>

<div class="language-hy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defn</span><span class="w"> </span><span class="n">simplified-bm-skip</span><span class="w"> </span><span class="p">[</span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="n">k</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nf">simplify-probfn</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">[</span><span class="n">prob-delta_1</span><span class="p">])</span><span class="w">
    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-delta_1-s</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-delta_1-worthless</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="n">m</span><span class="p">))</span><span class="w">
        </span><span class="p">(</span><span class="nf">prob-delta_1-s</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="n">k</span><span class="p">)))</span><span class="w">

</span><span class="p">(</span><span class="nb">defn</span><span class="w"> </span><span class="n">sbm-rate</span><span class="w"> </span><span class="p">[</span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nf">simplify-probfn</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">[</span><span class="n">prob-m</span><span class="w"> </span><span class="n">simplified-bm-skip</span><span class="p">])</span><span class="w">
    </span><span class="p">(</span><span class="nb">/</span><span class="w">
        </span><span class="p">(</span><span class="nf">map-sum</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">patlen</span><span class="p">)]</span><span class="w">
            </span><span class="p">(</span><span class="nb">fn</span><span class="w"> </span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nf">cost</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-m-s</span><span class="w"> </span><span class="n">m</span><span class="p">))))</span><span class="w">

        </span><span class="p">(</span><span class="nf">map-sum</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">patlen</span><span class="p">)]</span><span class="w">
            </span><span class="p">(</span><span class="nb">fn</span><span class="w"> </span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-m-s</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">map-sum</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="n">patlen</span><span class="p">]</span><span class="w">
                                        </span><span class="p">(</span><span class="nb">fn</span><span class="w"> </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">(</span><span class="nf">simplified-bm-skip-s</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="n">k</span><span class="p">)))))))))</span><span class="w">
</span></code></pre></div></div>

<p>å’ŒKMPç®—æ³•ï¼š</p>

<p><code class="language-plaintext highlighter-rouge">myprob,hy</code></p>

<div class="language-hy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defn</span><span class="w"> </span><span class="n">prob-pi</span><span class="w"> </span><span class="p">[</span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="p">]</span><span class="w">
    </span><span class="s">"prob-pi-s(m, l) = prob-pi-seq[m][l]"</span><span class="w">
    </span><span class="p">(</span><span class="nf">defseq</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w">
        </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">[(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">[]]</span><span class="w">
              </span><span class="p">[(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="w">
              </span><span class="p">[(</span><span class="nb">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">[(</span><span class="nb">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="n">p</span><span class="p">]]</span><span class="w">
              </span><span class="p">[(</span><span class="nb">&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">lfor</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">(</span><span class="nb">range</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
                            </span><span class="p">(</span><span class="nb">+</span><span class="w">
                                </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nf">getone</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="no">:default</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">p</span><span class="p">))</span><span class="w">
                                </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nb">get</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">i</span><span class="p">)))))]))</span><span class="w">
    </span><span class="n">prob-pi-seq</span><span class="p">)</span><span class="w">


</span><span class="p">(</span><span class="nb">defn</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="p">[</span><span class="n">m</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
        </span><span class="p">(</span><span class="nb">get</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="n">k</span><span class="p">))))</span><span class="w">

</span><span class="p">(</span><span class="nb">defn</span><span class="w"> </span><span class="n">at-least-1</span><span class="w"> </span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w">


</span><span class="p">(</span><span class="nb">defn</span><span class="w"> </span><span class="n">kmp-rate</span><span class="w"> </span><span class="p">[</span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="p">]</span><span class="w">
    </span><span class="p">(</span><span class="nf">simplify-probfn</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">[</span><span class="n">prob-m</span><span class="w"> </span><span class="n">prob-pi</span><span class="p">])</span><span class="w">
    </span><span class="p">(</span><span class="nb">setv</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-pi-s</span><span class="p">))</span><span class="w">
    </span><span class="p">(</span><span class="nb">/</span><span class="w">
        </span><span class="p">(</span><span class="nf">map-sum</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">patlen</span><span class="p">)]</span><span class="w">
            </span><span class="p">(</span><span class="nb">fn</span><span class="w"> </span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nf">cost</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-m-s</span><span class="w"> </span><span class="n">m</span><span class="p">))))</span><span class="w">

        </span><span class="p">(</span><span class="nf">map-sum</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">patlen</span><span class="p">)]</span><span class="w">
            </span><span class="p">(</span><span class="nb">fn</span><span class="w"> </span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="p">(</span><span class="nf">prob-m-s</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">map-sum</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nf">at-least-1</span><span class="w"> </span><span class="p">(</span><span class="nb">dec</span><span class="w"> </span><span class="n">m</span><span class="p">))]</span><span class="w">
                                        </span><span class="p">(</span><span class="nb">fn</span><span class="w"> </span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="nb">*</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">(</span><span class="nf">skip</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="n">prob-pi-seq</span><span class="p">)))))))))</span><span class="w">
</span></code></pre></div></div>

<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Pythonä¸Šçš„<code class="language-plaintext highlighter-rouge">plotnine</code>å›¾å½¢åŒ…çœ‹ä¸€ä¸‹è®¡ç®—çš„æ•°æ®ï¼ˆå¹¶ç”¨é«˜æ–¯è¿‡ç¨‹å›å½’æ‹Ÿåˆæ›²çº¿ï¼‰ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">hy</span>

<span class="kn">from</span> <span class="nn">my_prob</span> <span class="kn">import</span> <span class="n">bm_rate</span><span class="p">,</span> <span class="n">sbm_rate</span><span class="p">,</span> <span class="n">kmp_rate</span>


<span class="n">theme_update</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s">"SimHei"</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">model_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">'rate'</span><span class="p">:[],</span> <span class="s">'alg'</span><span class="p">:[],</span> <span class="s">'patlen'</span><span class="p">:[]}</span>
    <span class="n">categories_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">bm_rate</span><span class="p">,</span> <span class="s">'BoyerMoore'</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">sbm_rate</span><span class="p">,</span> <span class="s">'S BoyerMoore'</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">kmp_rate</span><span class="p">,</span> <span class="s">'KMP'</span><span class="p">),</span>
                       <span class="p">(</span><span class="k">lambda</span> <span class="n">patlen</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">patlen</span><span class="p">,</span> <span class="s">'$</span><span class="se">\\</span><span class="s">frac{1}{patlen}$'</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">alg_fun</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">categories_list</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'rate'</span><span class="p">].</span><span class="n">extend</span><span class="p">([</span><span class="n">alg_fun</span><span class="p">(</span><span class="n">patlen</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">patlen</span> <span class="ow">in</span> <span class="n">model_range</span><span class="p">])</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'alg'</span><span class="p">].</span><span class="n">extend</span><span class="p">([</span><span class="n">label</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">model_range</span><span class="p">])</span>
        <span class="n">data</span><span class="p">[</span><span class="s">'patlen'</span><span class="p">].</span><span class="n">extend</span><span class="p">(</span><span class="n">model_range</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">'patlen'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'rate'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'alg'</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
            <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">'gpr'</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">'Algs'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">'$patlen$'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">'$</span><span class="se">\\</span><span class="s">frac{cost}{skip}$'</span><span class="p">))</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">plot(1/256, '$p= \\frac{1}{256}$')</code>ï¼š</p>

<div class="sx-center"><img src="/../asserts/img/bm/bm_plot256.svg" alt="BM_plot256" style="zoom: 200%;" /></div>

<p>è§‚å¯Ÿè¿™ä¸ªå›¾åƒï¼Œä»¤äººå°è±¡æ·±åˆ»çš„é¦–å…ˆå°±æ˜¯æŠ¬å¤´çš„ä¸€æ¡å¤§å…°çº¿ï¼Œå‡ ä¹ç¬”ç›´åœ°ç”»å‡ºäº†ç®—æ³•æ€§èƒ½çš„ä¸‹é™ï¼Œä¸æ„§æ˜¯KMPç®—æ³•ï¼Œ$O(n)$çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¸€çœ‹å°±å¾ˆçœŸå®( ï¾Ÿâ–½ï¾Ÿ)/ ã€‚</p>

<p>æ¥ç€ä¼šå‘ç°BoyerMooreç®—æ³•ä¸ç®€åŒ–ç‰ˆBoyerMooreç®—æ³•é«˜åº¦é‡å çš„è¿™æ¡çº¢ç»¿ç´«æ›²çº¿ï¼ŒåŒæ—¶ä¹Ÿæ˜¯$\dfrac{1}{patlen}$ï¼Œ</p>

<p>è¿™å°±æ˜¯åœ¨ä¸€èˆ¬å­—ç¬¦é›†ä¸‹éšæœºæ–‡æœ¬æœç´¢èƒ½è¾¾åˆ°çš„$O(\dfrac{n}{m})$çš„å¼ºåŠ›ç®—æ³•å—ï¼Ÿ(ï¾Ÿâ–³ï¾Ÿ;ï¾‰)ï¾‰</p>

<p>å¦å¤–æ­¤æ—¶å¯ä»¥ç»å¤§å¤šæ•°çš„å­—ç¬¦è·³è½¬ä¾é $delta_1$ï¼ˆæ¯”$delta_2$é«˜å‡ ä¸ªæ•°é‡ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯åŸºäº$delta_1$è¡¨çš„BMå˜ç§ç®—æ³•æœ€ä½³çš„åº”ç”¨åœºæ™¯ï¼</p>

<p>æ¥ç€æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹åœ¨ç»å…¸çš„å°å­—ç¬¦é›†ï¼Œæ¯”å¦‚åœ¨DNA { A, C, T, G } ç¢±åŸºå¯¹åºåˆ—ä¸­ç®—æ³•çš„æ€§èƒ½è¡¨ç°ï¼ˆ<code class="language-plaintext highlighter-rouge">plot(1/4, '$p= \\frac{1}{4}$')</code>ï¼‰ï¼š</p>

<div class="sx-center"><img src="/../asserts/img/bm/bm_plot4.svg" alt="BM_plot4" style="zoom:200%;" /></div>

<p>æ›²çº¿å‡ºç°äº†æ˜æ˜¾çš„åˆ†åŒ–ï¼Œå½“ç„¶KMPè¿˜æ˜¯ä¸€å¦‚æ—¢å¾€åœ°ç¨³å®š( ï¾Ÿâ–½ï¾Ÿ)/ ï¼Œå¦‚æœæ­¤æ—¶åœ¨æµ‹è¯•ä¸­ç›‘æ§ä¸€ä¸‹ä¸€ä¸‹$delta_1$è¡¨å’Œ$delta_2$è¡¨ä½œç”¨æƒ…å†µä¼šå‘ç°ï¼š$delta_2$èµ·ä½œç”¨çš„æ¬¡æ•°è¶…è¿‡äº†$delta_1$ï¼Œè€Œä¸”$delta_2$è´¡çŒ®çš„è·³è¿‡å­—ç¬¦æ•°æ›´æ˜¯è¿œè¶…$delta_1$ï¼Œæ€è€ƒä¸‹ï¼Œè¿™ä»¶äº‹å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ã€‚</p>

<p>æ€»ç»“ä¸€ä¸‹ï¼Œé€šè¿‡æ¦‚ç‡æ¨¡å‹çš„è®¡ç®—ï¼Œä¸€æ–¹é¢çœ‹åˆ°äº†åœ¨è¾ƒå¤§çš„å­—ç¬¦é›†ï¼Œæ¯”å¦‚æ—¥å¸¸æœç´¢çš„è¿‡ç¨‹ä¸­BoyerMooreç³»åˆ—ç®—æ³•çš„ä¼˜è¶Šè¡¨ç°ï¼Œå…¶ä¸­ä¸»è¦ä¾èµ–$delta_1$è¡¨å®ç°å­—ç¬¦è·³è½¬ï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨è¾ƒå°çš„å­—ç¬¦é›†é‡Œï¼Œ$delta_1$çš„ä½œç”¨ä¸‹é™ï¼Œè€Œ$delta_2$çš„ä½œç”¨å¾—åˆ°äº†ä½“ç°ã€‚å¦‚æœæœ‰ä¸€å®šå¯Œè£•ç©ºé—´çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å®Œæ•´çš„ç©ºé—´å¤æ‚åº¦ä¸º$O(m)$çš„BoyerMooreç®—æ³•åº”è¯¥æ˜¯ä¸€ç§é€‚ç”¨å„ç§æƒ…å†µã€ç»¼åˆè¡¨ç°éƒ½å¾ˆä¼˜å¼‚çš„ç®—æ³•é€‰æ‹©ã€‚</p>

<h2 id="å¼•ç”¨">å¼•ç”¨</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1977BM" role="doc-endnote">
      <p>https://dl.acm.org/doi/10.1145/359842.359859Â <a href="#fnref:1977BM" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:1980Rytter" role="doc-endnote">
      <p>https://epubs.siam.org/doi/10.1137/0209037Â <a href="#fnref:1980Rytter" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:1977KMP" role="doc-endnote">
      <p>https://epubs.siam.org/doi/abs/10.1137/0206024Â <a href="#fnref:1977KMP" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:B5S" role="doc-endnote">
      <p>http://effbot.org/zone/stringlib.htm#BMHBNFSÂ <a href="#fnref:B5S" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:xxHash" role="doc-endnote">
      <p>https://cyan4973.github.io/xxHash/Â <a href="#fnref:xxHash" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>

    <div id="toc-wrapper" class="pl-0 pr-4 mb-5 post__toc">
      <nav id="toc" data-toggle="toc"></nav>
    </div>

  </div>

</article>

    </main>

    <div class="page__comment">
        <script src="https://giscus.app/client.js"
            data-repo="minghu6/minghu6.github.io"
            data-repo-id="MDEwOlJlcG9zaXRvcnkxMTI3NDIxOTA="
            data-category="Announcements"
            data-category-id="DIC_kwDOBrhPLs4CSYaE"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="1"
            data-input-position="top"
            data-theme="preferred_color_scheme"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
        </script>
    </div>
</div>

    <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    <footer class="footer">
        <section class="footer__about">
                <p class="footer__about__copyright">Â© minghu6</p>
                
                <span class="divider">Â·</span>
                
                <span class="footer__about__theme"><p>theme</p><a id="simplex-logo" href="https://github.com/andreondra/jekyll-theme-simplex" target="_blank"><img alt="Simplex theme logo" src="/assets/img/icons/simplex_logo.svg"/></a><p>by <a href="https://ondrej.golasowski.com/">golas</a></p></span>
        </section>
</footer>

    <script src="/assets/js/jquery.slim.min.js"></script>
<script src="/assets/js/lity.min.js"></script>
<script src="/assets/js/tools.js"></script>


<script type="text/javascript" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>


<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script> -->
<script>
  MathJax = {
  tex: {
    inlineMath: [
      ['$','$'],
      ['\\(','\\)']
    ],
    displayMath: [
      ['$$', '$$'],
      ['\\[', '\\]']
    ]
  }
}
</script>

<!-- <script>
var navSelector = "#toc";
// only show two levels
$("body").scrollspy({
  target: navSelector,
});
</script> -->


    <!--
Jekyll Simple Search loader
See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->



<script src="/assets/js/simple-jekyll-search.min.js"></script>

<script>
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: "/assets/search.json",
    searchResultTemplate: '  <div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0 justify-content-center">    <a href="{url}">{title}</a>    <div class="post__meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">      {categories}    </div>    <p>{snippet}</p>  </div>',
    noResultsText: '<p class="mt-5">No result</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }
    }
  });

  $(function() {
    const btnSearchTrigger = $("#search-trigger");
    const btnCancel = $("#search-cancel");
    const main = $(".main");
    const topbarTitle = $("#topbar-title");
    const searchWrapper = $("#search-wrapper");
    const resultWrapper = $("#search-result-wrapper");
    const results = $("#search-results");
    const input = $("#search-input");
    const hints = $("#search-hints");

    const scrollBlocker = (function() {
      let offset = 0;
      return {
        block() {
          offset = window.scrollY;
          $("html,body").scrollTop(0);
        },
        release() {
          $("html,body").scrollTop(offset);
        },
        getOffset() {
          return offset;
        }
      };
    }());

/*--- Actions in mobile screens (Sidebar hidden) ---*/

    const mobileSearchBar = (function() {
      return {
        on() {
          topbarTitle.addClass("unloaded");
          btnSearchTrigger.addClass("unloaded");
          searchWrapper.addClass("d-flex");
          btnCancel.addClass("loaded");
        },
        off() {
          btnCancel.removeClass("loaded");
          searchWrapper.removeClass("d-flex");
          topbarTitle.removeClass("unloaded");
          btnSearchTrigger.removeClass("unloaded");
        }
      };
    }());

    const resultSwitch = (function() {
      let visible = false;

      return {
        on() {
          if (! visible) {
            scrollBlocker.block();
            resultWrapper.removeClass("unloaded");
            main.addClass("unloaded");
            visible = true;
          }
        },
        off() {
          if (visible) {
            results.empty();
            if (hints.hasClass("unloaded")) {
              hints.removeClass("unloaded");
            }
            resultWrapper.addClass("unloaded");
            main.removeClass("unloaded");
            scrollBlocker.release();

            input.val("");
            visible = false;
          }
        },
        isVisible() {
          return visible;
        }
      };

    }());

    function isMobileView() {
      return btnCancel.hasClass("loaded");
    }

    btnSearchTrigger.click(function() {
      mobileSearchBar.on();
      resultSwitch.on();
      input.focus();
    });

    btnCancel.click(function() {
      mobileSearchBar.off();
      resultSwitch.off();
    });

    input.focus(function() {
      searchWrapper.addClass("input-focus");
    });

    input.focusout(function() {
      searchWrapper.removeClass("input-focus");
    });

    input.on("input", () => {
      if (input.val() === "") {
        if (isMobileView()) {
          hints.removeClass("unloaded");
        } else {
          resultSwitch.off();
        }

      } else {
        resultSwitch.on();
        if (isMobileView()) {
          hints.addClass("unloaded");
        }
      }
    });

  });
</script>

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">


</body>
</html>
